<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SDRC Customer Service Call Flow Chart</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';

        window._mermaid = mermaid;

        mermaid.initialize({
            startOnLoad: false,
            theme: 'default',
            flowchart: {
                useMaxWidth: false,
                htmlLabels: true,
                curve: 'basis',
                nodeSpacing: 80,
                rankSpacing: 120,
                padding: 25
            },
            themeVariables: {
                fontSize: '32px',
                fontFamily: 'Arial, sans-serif'
            }
        });

        // Called after each render to apply font + alignment overrides
        window.applyPostProcessing = function() {
            const svg = document.querySelector('#mermaidDiagram svg');
            if (!svg) return;

            const styleEl = document.createElementNS('http://www.w3.org/2000/svg', 'style');
            styleEl.textContent = `
                foreignObject div, foreignObject span, foreignObject p,
                foreignObject b, foreignObject i, foreignObject u,
                .nodeLabel, .nodeLabel * {
                    font-size: 26px !important;
                    line-height: 1.35 !important;
                    font-family: Arial, sans-serif !important;
                }
                .nodeLabel { text-align: left !important; }
                .nodeLabel * { text-align: left !important; }
                .edgeLabel foreignObject div, .edgeLabel .nodeLabel, .edgeLabel .nodeLabel * {
                    font-size: 22px !important;
                    font-weight: 700 !important;
                    text-align: center !important;
                }
            `;
            svg.insertBefore(styleEl, svg.firstChild);

            svg.querySelectorAll('text').forEach(el => { el.style.fontSize = '26px'; });

            svg.querySelectorAll('.nodeLabel').forEach(label => {
                const inner = label.querySelector('div') || label;
                if (!inner) return;
                const html = inner.innerHTML;
                const m = html.match(/^(<b>.*?<\/b>)(<br\/>|<br>)?(.*)/s);
                if (m) {
                    inner.innerHTML =
                        '<div style="text-align:center;font-weight:bold;margin-bottom:6px;">' + m[1] + '</div>' +
                        '<div style="text-align:left;padding-left:8px;">' + (m[3]||'') + '</div>';
                } else {
                    inner.style.textAlign = 'left';
                    inner.style.paddingLeft = '8px';
                }
            });

            svg.querySelectorAll('foreignObject').forEach(fo => {
                const div = fo.querySelector('div');
                if (div) {
                    const rect = div.getBoundingClientRect();
                    fo.setAttribute('width', Math.ceil(rect.width) + 20);
                    fo.setAttribute('height', Math.ceil(rect.height) + 20);
                }
            });

            const bbox = svg.getBBox();
            svg.setAttribute('viewBox', `${bbox.x-20} ${bbox.y-20} ${bbox.width+40} ${bbox.height+40}`);
            svg.setAttribute('width', bbox.width + 40);
            svg.setAttribute('height', bbox.height + 40);
        };

        window.renderDiagram = async function(source) {
            const container = document.getElementById('mermaidDiagram');
            container.removeAttribute('data-processed');
            container.innerHTML = source;
            await window._mermaid.run({ nodes: [container] });
            window.applyPostProcessing();
        };

        // Initial render
        window.addEventListener('load', () => {
            window.rebuildDiagram();
        });
    </script>
    <style>
        @page { size: A3 landscape; margin: 8mm; }
        * { box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            margin: 0; padding: 20px;
            background: #f0f4f8;
        }
        .container {
            max-width: 100%; background: white;
            padding: 28px; border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        h1 { color: #1a365d; text-align: center; margin-bottom: 4px; font-size: 26px; }
        .subtitle { text-align: center; color: #4a5568; margin-bottom: 18px; font-size: 13px; }

        /* Controls */
        .controls {
            display: flex; justify-content: center;
            gap: 10px; margin-bottom: 16px; flex-wrap: wrap;
        }
        .controls button {
            padding: 9px 18px; font-size: 13px; cursor: pointer;
            border: 2px solid #3182ce; background: white; color: #3182ce;
            border-radius: 6px; font-weight: 600; transition: all 0.2s;
        }
        .controls button:hover { background: #3182ce; color: white; }
        .controls button.print-btn { border-color: #38a169; color: #38a169; }
        .controls button.print-btn:hover { background: #38a169; color: white; }
        .controls button.img-btn { border-color: #805ad5; color: #805ad5; }
        .controls button.img-btn:hover { background: #805ad5; color: white; }
        .zoom-info {
            display: flex; align-items: center; padding: 9px 14px;
            background: #ebf8ff; border-radius: 6px;
            color: #2b6cb0; font-weight: 500; font-size: 13px;
        }

        /* Filter panel */
        .filter-panel {
            border: 2px solid #e2e8f0; border-radius: 10px;
            padding: 16px; margin-bottom: 20px; background: #f8fafc;
        }
        .filter-title {
            font-size: 13px; font-weight: 700; color: #4a5568;
            text-transform: uppercase; letter-spacing: 0.06em;
            margin-bottom: 12px; text-align: center;
        }
        .filter-groups {
            display: flex; gap: 10px; flex-wrap: wrap;
        }
        .cat-group {
            flex: 1; min-width: 160px;
            border: 2px solid; border-radius: 8px; padding: 10px 12px;
        }
        .cat-header {
            display: flex; justify-content: space-between;
            align-items: center; margin-bottom: 8px; font-size: 13px;
        }
        .mini-btn {
            padding: 1px 7px; font-size: 11px; cursor: pointer;
            border: 1.5px solid; background: white;
            border-radius: 4px; font-weight: 600;
            margin-left: 3px; transition: opacity 0.15s;
        }
        .mini-btn:hover { opacity: 0.7; }
        .check-label {
            display: flex; align-items: center; gap: 7px;
            font-size: 13px; cursor: pointer; padding: 3px 4px;
            border-radius: 5px; transition: background 0.12s;
        }
        .check-label:hover { background: rgba(0,0,0,0.04); }
        .check-label input { width: 15px; height: 15px; accent-color: var(--accent); cursor: pointer; }

        /* Status bar */
        .status-bar {
            text-align: center; padding: 8px; margin-bottom: 12px;
            font-size: 13px; color: #4a5568; background: #f0f4f8;
            border-radius: 6px; display: none;
        }
        .status-bar.show { display: block; }

        /* Save image panel */
        .img-options {
            display: none; justify-content: center; gap: 10px;
            margin-bottom: 16px; padding: 12px 16px;
            background: #f3e8ff; border: 2px solid #805ad5;
            border-radius: 8px; flex-wrap: wrap; align-items: center;
        }
        .img-options.show { display: flex; }
        .img-options label { font-weight: 600; color: #553c9a; font-size: 13px; }
        .img-options select { padding: 6px 10px; font-size: 13px; border: 2px solid #805ad5; border-radius: 6px; color: #553c9a; }
        .img-options button {
            padding: 8px 16px; font-size: 13px; cursor: pointer;
            border: 2px solid #805ad5; background: #805ad5;
            color: white; border-radius: 6px; font-weight: 600;
        }
        .img-options .cancel-btn { background: white; color: #805ad5; }
        .img-status { color: #553c9a; font-size: 13px; }

        /* Diagram area */
        .diagram-wrapper { border: 2px solid #e2e8f0; border-radius: 8px; overflow: hidden; background: #fafafa; }
        .diagram-container {
            width: 100%; height: 75vh; min-height: 600px;
            overflow: auto; padding: 20px;
            cursor: grab;
        }
        .diagram-container:active { cursor: grabbing; }
        .mermaid { transform-origin: top left; transition: transform 0.2s ease; }

        .rendering-msg {
            display: flex; align-items: center; justify-content: center;
            height: 200px; font-size: 16px; color: #718096;
        }

        /* Print */
        @media print {
            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
            html, body { width: 420mm; height: 297mm; margin: 0 !important; padding: 0 !important; background: white !important; overflow: visible !important; }
            body { padding: 4mm !important; }
            .container { box-shadow: none !important; padding: 4mm !important; border-radius: 0 !important; page-break-inside: avoid; }
            .controls, .filter-panel, .img-options, .status-bar { display: none !important; }
            h1 { font-size: 18px !important; margin-bottom: 2mm !important; }
            .subtitle { font-size: 10px !important; margin-bottom: 3mm !important; }
            .diagram-wrapper { border: 1px solid #ccc !important; }
            .diagram-container { height: auto !important; min-height: auto !important; overflow: visible !important; padding: 3mm !important; }
            .mermaid { transform: scale(0.25) !important; transform-origin: top left !important; width: 400% !important; }
            .mermaid svg { max-width: none !important; overflow: visible !important; }
        }
    </style>
</head>
<body>
<div class="container">
    <h1>SDRC Customer Service Call Flow Chart</h1>
    <p class="subtitle">Decision Tree Model ‚Äì Autonomy-Focused Guidance</p>

    <div class="controls">
        <button onclick="zoomIn()">‚ûï Zoom In</button>
        <button onclick="zoomOut()">‚ûñ Zoom Out</button>
        <button onclick="resetZoom()">üîÑ Reset View</button>
        <button onclick="fitToScreen()">üìê Fit to Screen</button>
        <button onclick="window.print()" class="print-btn">üñ®Ô∏è Print A3</button>
        <button onclick="saveSVG()" class="img-btn">‚¨áÔ∏è Download SVG</button>
        <div class="zoom-info">Zoom: <span id="zoomLevel">100</span>%</div>
        <span id="svgStatus" style="font-size:13px;color:#553c9a;align-self:center;"></span>
    </div>

    <div class="img-options" id="imgOptions" style="display:none"></div>

    <div class="filter-panel">
        <div class="filter-title">üîç Filter ‚Äî uncheck services to remove them from the diagram</div>
        <div class="filter-groups">
            
        <div class="cat-group" style="border-color:#2563eb;background:#eff6ff">
            <div class="cat-header" style="color:#2563eb">
                <strong>Property</strong>
                <span>
                    <button class="mini-btn" style="color:#2563eb;border-color:#2563eb" onclick="toggleCat('Property',true)">All</button>
                    <button class="mini-btn" style="color:#2563eb;border-color:#2563eb" onclick="toggleCat('Property',false)">None</button>
                </span>
            </div>
                <label class="check-label" style="--accent:#2563eb">
                    <input type="checkbox" id="cb_rates" data-cat="Property" checked onchange="rebuildDiagram()">
                    <span>üí∞ Rates</span>
                </label>
                <label class="check-label" style="--accent:#2563eb">
                    <input type="checkbox" id="cb_building" data-cat="Property" checked onchange="rebuildDiagram()">
                    <span>üèóÔ∏è Building</span>
                </label>
                <label class="check-label" style="--accent:#2563eb">
                    <input type="checkbox" id="cb_plumbing" data-cat="Property" checked onchange="rebuildDiagram()">
                    <span>üîß Plumbing</span>
                </label>
                <label class="check-label" style="--accent:#2563eb">
                    <input type="checkbox" id="cb_planning" data-cat="Property" checked onchange="rebuildDiagram()">
                    <span>üìê Planning</span>
                </label>
        </div>
        <div class="cat-group" style="border-color:#16a34a;background:#f0fdf4">
            <div class="cat-header" style="color:#16a34a">
                <strong>Community</strong>
                <span>
                    <button class="mini-btn" style="color:#16a34a;border-color:#16a34a" onclick="toggleCat('Community',true)">All</button>
                    <button class="mini-btn" style="color:#16a34a;border-color:#16a34a" onclick="toggleCat('Community',false)">None</button>
                </span>
            </div>
                <label class="check-label" style="--accent:#16a34a">
                    <input type="checkbox" id="cb_animals" data-cat="Community" checked onchange="rebuildDiagram()">
                    <span>üêï Animals</span>
                </label>
                <label class="check-label" style="--accent:#16a34a">
                    <input type="checkbox" id="cb_environmental" data-cat="Community" checked onchange="rebuildDiagram()">
                    <span>üåø Environmental</span>
                </label>
                <label class="check-label" style="--accent:#16a34a">
                    <input type="checkbox" id="cb_waste" data-cat="Community" checked onchange="rebuildDiagram()">
                    <span>üóëÔ∏è Waste</span>
                </label>
                <label class="check-label" style="--accent:#16a34a">
                    <input type="checkbox" id="cb_complaints" data-cat="Community" checked onchange="rebuildDiagram()">
                    <span>üìù Complaints</span>
                </label>
                <label class="check-label" style="--accent:#16a34a">
                    <input type="checkbox" id="cb_cemetery" data-cat="Community" checked onchange="rebuildDiagram()">
                    <span>‚ö±Ô∏è Cemetery</span>
                </label>
                <label class="check-label" style="--accent:#16a34a">
                    <input type="checkbox" id="cb_disputes" data-cat="Community" checked onchange="rebuildDiagram()">
                    <span>üè† Disputes</span>
                </label>
        </div>
        <div class="cat-group" style="border-color:#d97706;background:#fffbeb">
            <div class="cat-header" style="color:#d97706">
                <strong>Infrastructure</strong>
                <span>
                    <button class="mini-btn" style="color:#d97706;border-color:#d97706" onclick="toggleCat('Infrastructure',true)">All</button>
                    <button class="mini-btn" style="color:#d97706;border-color:#d97706" onclick="toggleCat('Infrastructure',false)">None</button>
                </span>
            </div>
                <label class="check-label" style="--accent:#d97706">
                    <input type="checkbox" id="cb_roads" data-cat="Infrastructure" checked onchange="rebuildDiagram()">
                    <span>üõ£Ô∏è Roads</span>
                </label>
                <label class="check-label" style="--accent:#d97706">
                    <input type="checkbox" id="cb_works" data-cat="Infrastructure" checked onchange="rebuildDiagram()">
                    <span>üî® Works</span>
                </label>
                <label class="check-label" style="--accent:#d97706">
                    <input type="checkbox" id="cb_campgrounds" data-cat="Infrastructure" checked onchange="rebuildDiagram()">
                    <span>üèïÔ∏è Campgrounds</span>
                </label>
        </div>
        <div class="cat-group" style="border-color:#7c3aed;background:#faf5ff">
            <div class="cat-header" style="color:#7c3aed">
                <strong>Other</strong>
                <span>
                    <button class="mini-btn" style="color:#7c3aed;border-color:#7c3aed" onclick="toggleCat('Other',true)">All</button>
                    <button class="mini-btn" style="color:#7c3aed;border-color:#7c3aed" onclick="toggleCat('Other',false)">None</button>
                </span>
            </div>
                <label class="check-label" style="--accent:#7c3aed">
                    <input type="checkbox" id="cb_licence" data-cat="Other" checked onchange="rebuildDiagram()">
                    <span>üìÑ Licences</span>
                </label>
                <label class="check-label" style="--accent:#7c3aed">
                    <input type="checkbox" id="cb_claims" data-cat="Other" checked onchange="rebuildDiagram()">
                    <span>‚ö†Ô∏è Claims</span>
                </label>
        </div>
        </div>
    </div>

    <div class="status-bar" id="statusBar">‚è≥ Rebuilding diagram...</div>

    <div class="diagram-wrapper">
        <div class="diagram-container" id="diagramContainer">
            <div class="mermaid" id="mermaidDiagram">
            </div>
        </div>
    </div>
</div>

<script>
    // ‚îÄ‚îÄ Diagram source sections ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const HEADER = `flowchart TD
    Start(["üìû Incoming Call"]) --> Greeting["<b>GREETING</b><br/><i>Southern Downs Regional Council,<br/>this is Name speaking.<br/>How can I help you today?</i>"]
    
    Greeting --> Verify["<b>CALL OPEN</b><br/>1. Listen to the customer as they tell you their reason for calling - take notes as they speak<br/>2. Ask follow up questions until you are confident you understand the reason why they are calling<br/>3. Offer customer a service or information relevant to their reason for calling - allow customer to confirm before proceeding<br/>4. If necessary verify customer details: Name, Address, Mobile and Email - match details in TechOne"]
    
    Verify --> Category{"<b>SERVICE CATEGORY?</b>"}`;

    const TAIL = `CustomerDetails["<b>CONFIRM DETAILS</b><br/>Name, Mobile, Email, Address"]

    %% =============================================
    %% ACTION DECISION
    %% =============================================

    CustomerDetails --> ActionDecision{"<b>ACTION?</b>"}
    
    ActionDecision -->|Lodge Merit| MeritBox["<b>üìã LODGE MERIT</b><br/><br/>1. Input appropriate keyword<br/>and follow process<br/>2. Description must include:<br/>Who, What, When, Where, Why<br/>3. Provide customer with<br/>Merit Req ID for follow-up<br/><br/>üìå Eli: Merit Process"]
    
    ActionDecision -->|Email Form| FormBox["<b>üìß EMAIL FORM</b><br/><br/>1. Find form: Eli FORMS<br/>2. Confirm customer email address<br/>3. Attach form to email<br/>4. Instruct customer: if emailing back,<br/>send to <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="ef828e8683af9c8b9d8cc19e838bc1888099c18e9a">[email&#160;protected]</a><br/>for records to process application<br/><br/>üìå Eli: FORMS"]
    
    ActionDecision -->|Process Payment| BPOINTBox["<b>üí≥ PROCESS PAYMENT - BPOINT</b><br/><br/>Ref 1: Customer Name<br/>Ref 2: Customer Address<br/>Ref 3: Reference Number<br/>(Application/Licence/Property ID)<br/>Merchant ID: Property ID<br/><br/>Email receipt to customer<br/>(confirm email address)<br/><br/>üìå Eli: BPOINT Guide"]
    
    ActionDecision -->|Transfer / Callback| TransferBox["<b>üì≤ TRANSFER / RETURN CALL</b><br/><br/>1. Establish context: Ask who &amp; why<br/><br/>2a. SDRC Staff/Department:<br/>By Name: Search The Pulse Staff List<br/>By Role: Eli Who to call - What they do<br/>Call to check availability<br/>If available: establish context, transfer<br/>If unavailable: arrange callback via<br/>Merit or email to staff/department<br/><br/>2b. Other Organisation:<br/>Provide contact details<br/>Eli Other Contacts<br/><br/>üìå Eli: Internal Directory"]
    
    ActionDecision -->|Info Provided| NoAction["<b>‚úÖ INFO PROVIDED</b><br/><br/>Customer has answer<br/>or referral contact"]
    
    MeritBox --> Close
    FormBox --> Close
    BPOINTBox --> Close
    TransferBox --> Close
    NoAction --> Close
    
    Close(["‚úÖ <b>CLOSE CALL</b><br/><br/><i>Is there anything else<br/>I can help you with today?</i>"])
    
    style Start fill:#d4edda,stroke:#28a745,stroke-width:2px
    style Close fill:#d4edda,stroke:#28a745,stroke-width:2px
    style Category fill:#fff3cd,stroke:#ffc107,stroke-width:2px
    style ActionDecision fill:#fff3cd,stroke:#ffc107,stroke-width:2px
    style BPOINTBox fill:#e8daef,stroke:#8e44ad,stroke-width:2px
    style TransferBox fill:#d4edda,stroke:#28a745,stroke-width:2px
    style CustomerDetails fill:#e2e3f3,stroke:#6c757d,stroke-width:2px
    style MeritBox fill:#f8d7da,stroke:#dc3545,stroke-width:2px
    style FormBox fill:#f8d7da,stroke:#dc3545,stroke-width:2px
    style NoAction fill:#d1ecf1,stroke:#17a2b8,stroke-width:2px`;

    const CAT_ENTRIES = {
    'Property': `    Category -->|Property| PropDecision{"<b>PROPERTY ISSUE?</b>"}`,
    'Community': `    Category -->|Community| CommDecision{"<b>COMMUNITY?</b>"}`,
    'Infrastructure': `    Category -->|Infrastructure| InfraDecision{"<b>INFRASTRUCTURE ISSUE?</b>"}`,
    'Other': `    Category -->|Other| OtherDecision{"<b>OTHER ISSUE?</b>"}`,
    };

    const SERVICE_CAT = { 'rates': 'Property', 'building': 'Property', 'plumbing': 'Property', 'planning': 'Property', 'animals': 'Community', 'environmental': 'Community', 'waste': 'Community', 'complaints': 'Community', 'cemetery': 'Community', 'disputes': 'Community', 'roads': 'Infrastructure', 'works': 'Infrastructure', 'campgrounds': 'Infrastructure', 'licence': 'Other', 'claims': 'Other' };

    const SECTIONS = {
    'rates': `    PropDecision -->|Rates| RatesDecision{"Payment or Admin?"}
    RatesDecision -->|Payment| RatesPayment["<b>üí∞ RATES - Payment</b><br/><br/>1. Look up property ID: Intramaps/TechOne<br/>2. Verify customer identity<br/>3. Use Property ID in TechOne - confirm balance owing<br/>4. Process payment in BPOINT<br/><br/>üìå Eli: Rates Process"]
    RatesDecision -->|Admin| RatesAdmin["<b>üí∞ RATES - Admin</b><br/><br/><u>Rates Balance:</u><br/>1. Look up property on TechOne<br/>2. Verify caller identity<br/>3. Provide current balance - if customer queries balance, offer to send most recent rates notice and transaction history<br/><br/><u>Payment Agreement:</u><br/>1. Look up property on TechOne<br/>2. Verify caller identity<br/>3. Check rate recovery code:<br/>[ ] General/FirstREM/FinalREM: proceed<br/>[ ] ARR: refer to R&amp;R: 1300 556 863<br/>[ ] Other: arrange callback from revenue department<br/>4. Generate spreadsheet - run XLOne report in TechOne<br/>5. Follow spreadsheet process with customer<br/>6. Save spreadsheet to pre-approved agreements folder: PID - SURNAME<br/>7. Email copy of spreadsheet to revenue (if customer rejected both payment options, inform revenue in email)<br/>8. Customer to await confirmation email from revenue<br/><br/><u>Copy of Rates Notice:</u><br/>1. Verify identity<br/>2. Search Property ID in Payreq<br/>3. Email most recent rates notice PDF to customer<br/>4. If customer requires rates notice from previous FY: look up fee in Fees &amp; Charges<br/><br/><u>Direct Debit:</u><br/>New: Email Form - Direct Debit Request<br/>Alter: Email Form - DD Alteration/Cancellation<br/><br/><u>Pensioner Rates Subsidy:</u><br/>1. Confirm address on pension card matches customer address in TechOne<br/>2. Email Form - Pension Subsidy Application - request customer attach a copy of pension card<br/>3. Customer may attend front counter to fill out form in person - we will photocopy their card<br/><br/><u>Sign up for Email Rates Notices:</u><br/>1. Refer customer to second page of rates notice - Go Paperless QR code<br/>2. Or search Go Paperless on SDRC website - create a Payreq account<br/>3. To sign up, customer must provide the name on the rates notice and their BPAY Reference number (found on most recent rates notice)<br/>4. Customer must ensure email address used to sign up for Payreq matches the one on file in TechOne<br/><br/>üìå Eli: Rates<br/>üìå Eli: Payment Agreement<br/>üìå Eli: Direct Debit<br/>üìå Eli: SDRC - Go Paperless"]

    RatesPayment --> CustomerDetails
    RatesAdmin --> CustomerDetails`,
    'building': `    PropDecision -->|Building| BuildingDecision{"New, Existing,<br/>or Inspection?"}
    BuildingDecision -->|New| BuildingNew["<b>üèóÔ∏è BUILDING - New</b><br/><br/>New Enquiry<br/>1. Provide Factsheets:<br/>Building Info Sheets - SDRC<br/>2. Arrange callback:<br/>Merit Building - Follow Process<br/>Provide customer with Merit #<br/><br/>üìå <a href="https://www.sdrc.qld.gov.au/doing-business/planning-development/building/building-info-sheets" target="_blank">SDRC Website - Building info sheets</a><br/>üìå <a href="https://www.planning.qld.gov.au/planning-framework/development-assessment/development-assessment-process/forms-and-templates" target="_blank">DA Form 2 - With examples</a>"]
    BuildingDecision -->|Can I build?| BuildingCanI
    BuildingCanI["<b>üèóÔ∏è BUILDING - Can I build a dwelling / second dwelling / shed on this land?</b><br/><br/>There are two types of approvals that may be required for construction: building approval and planning approval.<br/><br/>Most new structures require building approval. Note: a shed less than 10m2 does not require building approval, but must still comply with siting and boundary clearance rules.<br/><br/>Whether planning approval is required depends on many factors. The most common reason to require planning approval is that the planned construction cannot meet the required setbacks of the Southern Downs Planning Scheme - the document prepared by council ensuring growth aligns with community and environmental considerations.<br/><br/><u>Common reasons that may prevent building:</u><br/>- Underground infrastructure beneath the proposed site (e.g. sewer line)<br/>- *More to be added*<br/><br/><u>Common reasons that may make building uneconomical:</u><br/>- Lack of constructed road access to the property<br/>- *More to be added*<br/><br/><u>Setbacks - Dwellings:</u><br/>Residential and township zones: Queensland Development Code MP 1.2 applies. Generally 6m from the front boundary and 1.5m from side and rear boundaries.<br/>Rural zone: 60m from side and rear lot boundaries. 60m from any boundary with a gravel or unmade road reserve. 6m from a sealed road.<br/>Rural residential zone: Refer to the Southern Downs Planning Scheme.<br/><br/><u>Setbacks - Sheds:</u><br/>Residential and township zones: 6m from the front boundary, 1.5m from side and rear boundaries.<br/>Rural/specific zones: Setbacks may differ, often 4.5m to 6m. Refer to the Queensland Development Code.<br/><br/>If you cannot meet the setbacks a planning application is necessary. There are multiple other reasons why a planning application may be necessary.<br/><br/>Use the checklists below to determine whether planning approval is required for the chosen site, and provide the customer with the online mapping tool to check overlays. If time permits, assist the customer in working through the checklist.<br/><br/>Building a house in the Rural Zone: <a href='https://www.sdrc.qld.gov.au/ArticleDocuments/527/Building%20a%20House%20in%20Rural%20Zone.pdf.aspx' target='_blank'>Checklist</a><br/>Dual occupancy (second dwelling) in the Rural Zone: <a href='https://www.sdrc.qld.gov.au/ArticleDocuments/527/Dual%20occupancy%20(second%20dwelling)%20in%20the%20Rural%20Zone.pdf.aspx' target='_blank'>Checklist</a><br/>Dual Occupancy in the Residential and Rural Residential Zones: <a href='https://www.sdrc.qld.gov.au/ArticleDocuments/527/Dual%20occupancy%20(Duplex)%20in%20the%20Residential%20and%20Rural%20residential%20Zones.pdf.aspx' target='_blank'>Checklist</a><br/><br/>üìå <a href='https://sdrc.spatial.t1cloud.com/spatial/intramaps/?configId=15145eaf-c419-4c91-aa46-f0b9d5637836&amp;project=Online%20Mapping' target='_blank'>Online Mapping</a><br/>üìå <a href='https://www.sdrc.qld.gov.au/doing-business/planning---development/strategic-planning' target='_blank'>Southern Downs Planning Scheme</a>"]
    BuildingDecision -->|New - General Info| BuildingNewInfo["<b>üèóÔ∏è BUILDING - Building approval general process</b><br/><br/>Advise Customer: If you have a construction project in mind, a good starting point is to obtain a quote from multiple licenced contractors. A contractor can advise on the specific materials/methods they would use, provide a rough schedule for completion of the work, and provide a cost estimate.<br/><br/>Licenced contractors are bound by state legislation to complete work to a standard that will pass inspection. Getting a quote can assist you in identifying the most practical approach to the project which will assist with preparing your building application.<br/><br/>Note that no work of any description is to be commenced until your building application is approved.<br/><br/>Your application will require a DA Form 2, and depending on the nature of your build (e.g. dwelling, extension, shed, garage) multiple supporting documents.<br/>Offer to email the customer the relevant fact sheet + link to SDRC website.<br/><br/><u>A typical application includes:</u><br/>[ ] Completed DA Form 2 - this is the state government form commonly referred to as the building application<br/><br/><u>Plus supporting documents:</u><br/>[ ] Site Plan, Floor Plan, Elevations and Structural Details<br/>[ ] Footing/Slab Design and Form 15 (must be signed by RPEQ registered engineer)<br/>[ ] Energy Efficiency Report (Class 1a dwellings)<br/>[ ] Soil Test Report (Class 1a dwellings)<br/>[ ] QBCC Insurance Certificate: Mandatory insurance for residential construction valued over $3,300. Protects the owner if the builder fails to complete the work or produces defects.<br/>OR<br/>[ ] QBCC Owner Builder Permit (building yourself, value $11,000 or more): Legal permit allowing a property owner to act as their own Head Contractor. Requires completion of a short certified course through a Registered Training Organisation.<br/>[ ] QLeave Payment Receipt (if value of building work over $150,000 excl. GST): QLeave manages portable long service leave for QLD construction workers. The project must be registered on the QLeave portal before construction begins. Council cannot issue Building Approval until this receipt is sighted.<br/><br/>Note that for certain applications it may also be necessary to provide information regarding bushfire attack level, flood zone, termite protection, lighting, water tanks etc.<br/><br/><u>Private Building Certifier:</u><br/>It is possible to engage a private building certifier to prepare and lodge the application on your behalf. Most customers undertaking larger projects choose this option.<br/><br/>The certifier will assist with producing the necessary documentation, and can subcontract additional professionals when required (architects, engineers, surveyors, soil tests, energy efficiency reports, bushfire attack level reports etc.).<br/><br/>Post lodgement, the certifier will liaise with council on your behalf and conduct on-site inspections throughout construction.<br/><br/><u>Construction Inspections:</u><br/>1. Footing/Foundation<br/>2. Slab<br/>3. Frame<br/>4. Final<br/><br/>Each stage must be signed off before the next commences. Once the final inspection is passed, a Form 21 Final Certificate is issued. In the case of new dwellings, the property may not be inhabited until this certificate has been issued.<br/><br/><u>If the build does not pass inspection:</u><br/>The QBCC can issue a formal Direction to Rectify, requiring the builder to fix the work at their own cost within a set timeframe. Non-compliance may result in significant fines and licence suspension. If a builder refuses or fails to rectify defective work, the QBCC can assist the homeowner through other means, including the Queensland Home Warranty Scheme.<br/><br/>SDRC customer service staff can assist in directing specific building queries to the council building team.<br/><br/>üìå <a href="https://www.sdrc.qld.gov.au/doing-business/planning-development/building/building-info-sheets" target="_blank">SDRC Website - Building info sheets</a><br/>üìå <a href="https://www.planning.qld.gov.au/planning-framework/development-assessment/development-assessment-process/forms-and-templates" target="_blank">DA Form 2 - With examples</a>"]
    BuildingDecision -->|Existing| BuildingExist["<b>üèóÔ∏è BUILDING - Existing</b><br/><br/><u>Existing Application:</u><br/>1. Check if customer is using a private certifier - if so, refer them back to their certifier<br/>2. If no private certifier: look up BLD number, confirm query details, transfer to relevant person<br/>3. If unavailable - arrange callback:<br/>[ ] Merit Building - Follow Process<br/>[ ] Provide customer with Merit #<br/><br/>üìå Eli: Building Applications"]
    BuildingDecision -->|Inspection| BuildingInspec["<b>üèóÔ∏è BUILDING - Inspection</b><br/><br/><u>Booking Building Inspections:</u><br/>1. Follow Email Template<br/>2. Notify inspectors by email<br/><br/>üìå Eli: Building Inspections"]

    BuildingInspec --> CustomerDetails
    BuildingExist --> CustomerDetails
    BuildingNew --> CustomerDetails
    BuildingCanI --> CustomerDetails
    BuildingNewInfo --> CustomerDetails`,
    'plumbing': `    PropDecision -->|Plumbing| PlumbingDecision{"Type?"}
    PlumbingDecision -->|Do I need approval?| PlumbNew["<b>üîß PLUMBING - Do I need approval?</b><br/><br/>1. Unregulated work - No approval required: Homeowners may fix minor plumbing maintenance issues without requiring a licensed tradesperson or council approval.<br/>üìå <a href='https://www.sdrc.qld.gov.au/doing-business/plumbing---drainage/plumbing-approvals/unregulated-work' target='_blank'>SDRC - Unregulated Work</a><br/><br/>2. Minor work - No approval required: Minor work does not require council approval but must be performed by an appropriately licensed person.<br/>üìå <a href='https://www.sdrc.qld.gov.au/doing-business/plumbing-drainage/plumbing-approvals/minor-work-plumbing' target='_blank'>SDRC - Minor Work</a><br/><br/>3. Notifiable work - No approval required: Your licensed plumber will notify the council on your behalf.<br/><br/>4. Compliance assessable work - Yes, approval and inspections required: Typically a plumber or building certifier will submit the necessary applications.<br/><br/>5. If necessary arrange callback from plumbing team:<br/>[ ] Merit Plumbing - Follow Process<br/>[ ] Provide customer with Merit #<br/><br/>üìå Eli: Plumbing FAQ"]
    PlumbingDecision -->|Existing| PlumbExist["<b>üîß PLUMBING - Existing</b><br/><br/><u>Existing Application:</u><br/>1. Transfer to relevant person<br/>2. If unavailable - arrange callback:<br/>[ ] Merit Plumbing - Follow Process<br/>[ ] Provide customer with Merit #<br/><br/>üìå Eli: Plumbing Applications"]
    PlumbingDecision -->|Water/Sewer| PlumbConnect["<b>üîß PLUMBING - Connections</b><br/><br/><u>Connect to Sewer/Water:</u><br/>1. Check Intramaps Water &amp; Sewerage Module<br/>2. Standard or Non-Standard? All 4 = YES:<br/>[ ] Within 100m of 100mm main<br/>[ ] Has Vacant Access Charges<br/>[ ] In declared Catchment Area<br/>[ ] Single lot/duplex/secondary/subdivision<br/>3. If Standard: Email Form - Application for Water or Sewer Services<br/>4. If Non-Standard: Email Form - Private Works (Water &amp; Sewerage Forms - SDRC)<br/><br/>üìå Eli: Connections Guide"]
    PlumbingDecision -->|Water Leak| PlumbLeak["<b>üîß PLUMBING - Water Leak</b><br/><br/>1. Check Aqualas for leak location relative to water meter<br/>2. Council side: Merit Leak - Contact Maintenance Supervisor<br/>3. Customer side: Advise customer to contact a licensed plumber<br/><br/>üìå Eli: Water Leak Procedure"]
    PlumbingDecision -->|Inspection| PlumbInspec["<b>üîß PLUMBING - Inspection</b><br/><br/><u>Booking Plumbing Inspections:</u><br/>1. Obtain from customer:<br/>- PD number<br/>- Structure type<br/>- Location<br/>- Preferred start time<br/>- Inspection type:<br/>[ ] Under slab (sub-drain)<br/>[ ] Stack/elevated pipework to be covered<br/>[ ] Drainage (sanitary house drain)<br/>[ ] Water services (rough in)<br/>[ ] Final plumbing inspection<br/><br/>Also obtain:<br/>- Plumbing assessment/approval number<br/>- Responsible person name and contact details<br/><br/>2. Check plumbing inspector calendar for availability - allow 30 min between inspections for travel<br/>3. Add inspection to calendar<br/>4. Notify inspectors by email<br/><br/>üìå Eli: Plumbing Inspections"]

    PlumbNew --> CustomerDetails
    PlumbExist --> CustomerDetails
    PlumbConnect --> CustomerDetails
    PlumbLeak --> CustomerDetails
    PlumbInspec --> CustomerDetails`,
    'planning': `    PropDecision -->|Planning| PlanningDecision{"Type?"}
    PlanningDecision -->|New| PlanNew["<b>üìê PLANNING - New</b><br/><br/>New Enquiry<br/>1. Provide Factsheets:<br/>Planning Information Sheets - SDRC<br/>2. Arrange callback:<br/>Merit Planning - Follow Process<br/>Provide customer with Merit #<br/><br/>üìå Eli: Planning Info Sheets"]
    PlanningDecision -->|Existing| PlanExist["<b>üìê PLANNING - Existing</b><br/><br/>Existing Application<br/>1. Take info regarding query:<br/>Merit Planning - Follow Process<br/>Provide customer with Merit #<br/>2. Transfer to Duty Planner<br/>3. If unavailable: instruct customer<br/>to wait for callback - max 5 business days<br/><br/>üìå Eli: Planning Applications"]
    PlanningDecision -->|Payment| PlanPayment["<b>üìê PLANNING - Application Fee</b><br/><br/>Process payment in BPOINT<br/>Email receipt to:<br/><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="c4a0a1b2a1a8abb4a9a1aab084b7a0b6a7eab5a8a0eaa3abb2eaa5b1">[email&#160;protected]</a><br/><br/>üìå Eli: Planning Applications"]

    %% =============================================

    PlanNew --> CustomerDetails
    PlanExist --> CustomerDetails
    PlanPayment --> CustomerDetails`,
    'animals': `    CommDecision -->|Animals| AnimalType{"Issue Type?"}
    AnimalType -->|Lost/Found| AnimalLost["<b>üêï ANIMALS - Lost/Found</b><br/><br/>Lost &amp; Found Cats, Dogs &amp; Other Animals<br/>1. Add to register:<br/>S:\\Customer Service\\Shared All\\<br/>Animals - Lost and Found Register<br/>2. Notify CS Group + Local Laws by email<br/><br/>üìå Eli: Lost Animals Register"]
    AnimalType -->|Registration| AnimalReg["<b>üêï ANIMALS - Dog Registration</b><br/><br/>1. Email Form: Application for<br/>Dog Registration<br/>2. If applicable, request:<br/>Proof of Desexing<br/>Pension Card<br/>Dog Breeder Supply Number<br/><br/>üìå Eli: Dog Registration"]
    AnimalType -->|Impounded| AnimalImpound["<b>üêï ANIMALS - Impounded</b><br/><br/>1. Check register:<br/>S:\\Customer Service\\Shared All\\Animals -<br/>Impoundments - Warwick - from 1 Jan 2019<br/>2. Contact Local Laws Officer to<br/>arrange collection<br/>3. Confirm release fee<br/><br/>üìå Eli: Impounded Animals"]
    AnimalType -->|Barking| BarkingType{"New or Ongoing?"}
    BarkingType -->|New| BarkNew["<b>üêï ANIMALS - Barking (New)</b><br/><br/>1. Strongly encourage direct contact<br/>with dog owner - letter template available<br/>2. Merit Barking - provide Merit #<br/>3. Provide barking dogs fact sheet +<br/>noise diary<br/>4. Instruct customer to email completed<br/>diary to <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="1479757d7854677066773a6578703a737b623a7561">[email&#160;protected]</a><br/>5. When diary received Local Laws<br/>will investigate<br/><br/>üìå Eli: Barking Procedure"]
    BarkingType -->|Ongoing| BarkOngo["<b>üêï ANIMALS - Barking (Ongoing)</b><br/><br/>1. Add note to existing Merit that<br/>another complaint has been received<br/>2. Include return phone number<br/><br/>üìå Eli: Barking Updates"]
    AnimalType -->|Surrender| AnimalSurrender["<b>üêï ANIMALS - Private Impoundment</b><br/><br/>Surrender of Dogs/Cats<br/>1. Email Form: Owners Consent to<br/>Privately Impound Dog or Cat<br/>2. Take impoundment fee over phone<br/>(Fees &amp; Charges: Private impounding)<br/>3. Email customer the receipt<br/>4. Email Local Laws the receipt<br/>5. Call Pound to arrange mutually<br/>suitable surrender time<br/><br/>üìå Eli: Private Impoundment"]
    AnimalType -->|Attack/Menacing| AnimalAttack["<b>üêï ANIMALS - Dog Attack/Menacing</b><br/><br/>Merit Attack - Record:<br/>Is customer still in danger of attack?<br/>Is the dog still in the area?<br/>Where exactly did the attack take place?<br/>When? (date and time)<br/>Was medical treatment required?<br/><br/>Email Form: Statement of Dog Attack Form<br/><br/>üìå Eli: Dog Attack Protocol"]
    AnimalType -->|Stray| AnimalStray["<b>üêï ANIMALS - Straying Dog</b><br/><br/>1. Merit Stray - Record:<br/>Location, Breed, Direction, Time<br/>2. Call Local Laws Officer to report<br/><br/>üìå Eli: Stray Dog Procedure"]
    AnimalType -->|Wildlife/Cruelty| AnimalWildlife["<b>üêï ANIMALS - Wildlife &amp; Cruelty</b><br/><br/><u>Animal Cruelty/Welfare:</u><br/>Direct to RSPCA: 1300 264 625<br/>or rspca.org.au/report-animal-cruelty<br/><br/><u>Wildlife Removal:</u><br/>Provide appropriate wildlife carer<br/>contact details to customer<br/><br/>üìå Eli: Animal Topics Index"]
    AnimalType -->|Keeping/Pest| AnimalKeepPest["<b>üêï ANIMALS - Keeping &amp; Pest</b><br/><br/><u>Keeping of Animals:</u><br/>Numbers allowed in town/rural: see<br/>Keeping of Animals Factsheet<br/>Application to keep additional animals<br/><br/><u>Pest Animals:</u><br/>Search SDRC website for Factsheets<br/>State Gov: Invasive Animals Fact Sheets<br/><br/>üìå Eli: Keeping Animals v2"]

    AnimalLost --> CustomerDetails
    AnimalReg --> CustomerDetails
    AnimalImpound --> CustomerDetails
    BarkNew --> CustomerDetails
    BarkOngo --> CustomerDetails
    AnimalSurrender --> CustomerDetails
    AnimalAttack --> CustomerDetails
    AnimalStray --> CustomerDetails
    AnimalWildlife --> CustomerDetails
    AnimalKeepPest --> CustomerDetails`,
    'environmental': `    CommDecision -->|Environmental| EnvType{"Stage?"}
    EnvType -->|Initial| EnvStart["<b>üåø ENV NUISANCE - Start</b><br/><br/>1. Determine if council has jurisdiction<br/>Eli: Environmental Nuisance &amp; Pollution<br/>+ SDRC Website<br/>2. If NO jurisdiction:<br/>Direct to appropriate contact<br/>3. If council HAS jurisdiction:<br/>Encourage customer to reach out to<br/>polluter directly and attempt to<br/>resolve without council assistance<br/><br/>üìå Eli: Jurisdiction Check"]
    EnvType -->|Lodge| EnvLodge["<b>üåø ENV NUISANCE - Lodge</b><br/><br/>1. Merit Environment - Choose<br/>appropriate option and lodge request<br/>2. If nuisance is ongoing:<br/>Provide Environmental Nuisance Diary<br/>for evidence and to guide investigation<br/>3. Instruct customer to email completed<br/>diary (14 days) to <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="2d404c44416d5e495f4e035c4149034a425b034c58">[email&#160;protected]</a><br/>Quote Merit number in email<br/><br/>üìå Eli: Nuisance Diary"]

    EnvStart --> CustomerDetails
    EnvLodge --> CustomerDetails`,
    'waste': `    CommDecision -->|Waste| WasteType{"Request Type?"}
    WasteType -->|Missed/Broken| WasteMissed["<b>üóëÔ∏è WASTE - Missed/Broken</b><br/><br/>Residential Missed Service/Broken Bins<br/>1. Confirm: address, name, phone number<br/>2. Instruct: leave damaged bin on curb<br/>Cleanaway may complete before next<br/>scheduled collection<br/>3. Customer can continue using bin<br/>4. Lodge Cleanaway Bin Request<br/><br/>üìå Cleanaway Service Request"]
    WasteType -->|Missing| WasteMissing["<b>üóëÔ∏è WASTE - Missing Bin</b><br/><br/>1. Confirm: address, name, phone number<br/>2. Lodge Cleanaway Bin Request<br/><br/>üìå Cleanaway Service Request"]
    WasteType -->|Public Place| WastePublic["<b>üóëÔ∏è WASTE - Public Place Bin</b><br/><br/>1. Confirm bin location with customer<br/>2. Check if bin is Council or Cleanaway:<br/>Intramaps - Environment &amp; Regulatory<br/>Check Cleanaway Public Place Bins Icon<br/>3. If Cleanaway: Lodge Cleanaway request<br/>4. If Council: Merit Maintenance<br/>Select Parks, Garden, Reserves<br/><br/>üìå Intramaps Guide"]
    WasteType -->|Infirm| WasteInfirm["<b>üóëÔ∏è WASTE - Infirm Service</b><br/><br/>1. Customer to provide:<br/>Letter requesting infirm service<br/>Note from registered health care practitioner<br/>2. Send to <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="503d31393c10233422337e213c347e373f267e3125">[email&#160;protected]</a><br/>Records will task to waste team directly<br/><br/>üìå Infirm Process"]
    WasteType -->|Complaint| WasteComplaint["<b>üóëÔ∏è WASTE - Cleanaway Complaint</b><br/><br/>Lodge Merit Complaint<br/>Select: Bins/Collection<br/><br/>üìå Eli: Complaint Process"]

    WasteMissed --> CustomerDetails
    WasteMissing --> CustomerDetails
    WastePublic --> CustomerDetails
    WasteInfirm --> CustomerDetails
    WasteComplaint --> CustomerDetails`,
    'complaints': `    CommDecision -->|Complaints| ComplaintRoute["<b>üìù COMPLAINTS</b><br/><br/>For complaints about a council service:<br/><br/>Option 1: Merit Complaint<br/>Select appropriate option<br/><br/>Option 2: Email to <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="f499959d98b487908697da859890da939b82da9581">[email&#160;protected]</a><br/>Subject: ATTN: Name<br/>Records will allocate to relevant person<br/><br/>Option 3: Email Form - Complaint Form<br/><br/>üìå Eli: Complaint Process"]

    ComplaintRoute --> CustomerDetails`,
    'cemetery': `    CommDecision -->|Cemetery| CemeteryType{"Type?"}
    CemeteryType -->|Reserve/Plaque| CemeteryRes["<b>‚ö±Ô∏è CEMETERY - Reserve/Plaque</b><br/><br/>New Reserve:<br/>Email Form: Reserve Application<br/><br/>üìå Eli: Cemetery Reserve"]
    CemeteryType -->|Memorial| CemeteryMemorial["<b>‚ö±Ô∏è CEMETERY - Roadside Memorial</b><br/><br/>Email Form:<br/>Roadside Memorial Application (SDRC Website)<br/><br/>üìå Eli: Roadside Memorials"]
    CemeteryType -->|Location/Interment| CemeteryLoc["<b>‚ö±Ô∏è CEMETERY - Location/Interment</b><br/><br/>1. Transfer to Cemetery staff<br/>2. If unavailable: schedule callback<br/>3. Cemetery Database - Location of<br/>Buried Person:<br/>S:\\Shared All\\Cemetery\\Cemetery Database<br/><br/>üìå Eli: Cemetery Database"]

    CemeteryRes --> CustomerDetails
    CemeteryMemorial --> CustomerDetails
    CemeteryLoc --> CustomerDetails`,
    'disputes': `    CommDecision -->|Disputes| DisputeType{"Jurisdiction?"}
    DisputeType -->|Council| DisputeCouncil["<b>üè† NEIGHBOURLY DISPUTES - Council</b><br/><br/>Dust/Smoke/Noise/Light/Odour/<br/>Water Pollution:<br/>See ENV NUISANCE<br/><br/>Keeping of Animals/Barking/<br/>Dangerous Dogs: See ANIMALS<br/><br/>Illegal Use of Caravan/Tents/Buses,<br/>Illegal Use of Building,<br/>Unauthorised Building Works:<br/>Merit Building<br/><br/>Unlawful Land Use:<br/>Merit Planning<br/><br/>üìå Eli: Disputes Guide"]
    DisputeType -->|Private| DisputePrivate["<b>üè† NEIGHBOURLY DISPUTES - Private</b><br/><br/>Generally refer to QCAT<br/>QLD Gov: Housing &amp; Neighbours<br/><br/>Parking complaints outside<br/>Warwick CBD: Refer to Police<br/>Eli: Regulated Parking<br/><br/>üìå QCAT Referral"]

    %% =============================================

    DisputeCouncil --> CustomerDetails
    DisputePrivate --> CustomerDetails`,
    'roads': `    InfraDecision -->|Roads| RoadType{"Issue Type?"}
    RoadType -->|Pothole| RoadPot["<b>üõ£Ô∏è ROADS - Pothole</b><br/><br/>1. Merit Pothole<br/>2. Confirm: sealed or unsealed road<br/>3. Record exact location<br/><br/>üìå Eli: Pothole Reporting"]
    RoadType -->|Road Kill| RoadKill["<b>üõ£Ô∏è ROADS - Road Kill</b><br/><br/>Get details from customer:<br/><br/>If &gt;100kg: Merit Dead<br/>If &lt;100kg: Lodge Cleanaway request<br/><br/>üìå Cleanaway/TMR"]
    RoadType -->|Closure| RoadClose["<b>üõ£Ô∏è ROADS - Closure</b><br/><br/>1. Check Disaster Dashboard<br/>2. Provide link to customer<br/>for real-time updates<br/><br/>üìå Disaster Dashboard Link"]
    RoadType -->|Rail/HWY| RoadRef["<b>üõ£Ô∏è ROADS - Rail/Highway</b><br/><br/>Train Tracks / Railway Crossings:<br/>QLD Rail: 13 16 17<br/><br/>Highway:<br/>TMR: 13 20 80<br/><br/>üìå Referral Contacts"]

    RoadPot --> CustomerDetails
    RoadKill --> CustomerDetails
    RoadClose --> CustomerDetails
    RoadRef --> CustomerDetails`,
    'works': `    InfraDecision -->|Works| WorksType{"Type?"}
    WorksType -->|Minor| WorksMinor["<b>üî® WORKS - Minor Works</b><br/><br/>Minor Works Within a Road Reserve<br/><br/>See Eli: Roads &amp; Works Forms<br/>for application requirements<br/><br/>üìå Eli: Minor Works Process"]
    WorksType -->|Private| WorksPriv["<b>üî® WORKS - Private Works</b><br/><br/>Member of public engages council<br/>to conduct works on private property<br/><br/>Roads &amp; Works Forms - SDRC<br/><br/>üìå Eli: Private Works Forms"]
    WorksType -->|Operational| WorksOp["<b>üî® WORKS - Operational Works</b><br/><br/>Operational Works inquiry<br/><br/>Merit Works + provide details<br/><br/>üìå Eli: Operational Works"]

    WorksMinor --> CustomerDetails
    WorksPriv --> CustomerDetails
    WorksOp --> CustomerDetails`,
    'campgrounds': `    InfraDecision -->|Campgrounds| CampType{"Facility?"}
    CampType -->|Washpool| CampWash["<b>üèïÔ∏è WASHPOOL</b><br/><br/>Enquiries: Eli Washpool<br/>Additional info: Caretaker<br/>Vicki Lynam 0427 026 216<br/>Price: Fees &amp; Charges CTRL+F 523<br/><br/>Bookings:<br/>Refer to Vicki Lynam 0427 026 216<br/>Instruct to leave voicemail if no answer<br/><br/>üìå Eli: Washpool Guide"]
    CampType -->|Connolly Dam| CampConn["<b>üèïÔ∏è CONNOLLY DAM</b><br/><br/>Enquiries: Eli Connolly Dam Camping<br/>Price: Fees &amp; Charges CTRL+F 523<br/><br/>Bookings:<br/>Self-Registration on site<br/>Payment: Cash, cheque, or credit card<br/>Yellow permit on windscreen<br/><br/>üìå Eli: Connolly Dam"]
    CampType -->|River Road| CampRiver["<b>üèïÔ∏è CONDAMINE RIVER ROAD</b><br/><br/>1. Check Disaster Dashboard<br/>2. If rain forecasted: link customer<br/>to dashboard for most current info<br/><br/>üìå Disaster Dashboard"]

    %% =============================================

    CampWash --> CustomerDetails
    CampConn --> CustomerDetails
    CampRiver --> CustomerDetails`,
    'licence': `    OtherDecision -->|Licence| LicenseType{"Action?"}
    LicenseType -->|Pay| LicensePay["<b>üìÑ LICENCE - Pay/Renew</b><br/><br/>Gather info, process via BPOINT ECM<br/>Customer email needed for receipt<br/><br/>üìå Eli: Licence Renewal"]
    LicenseType -->|Apply| LicenseApply["<b>üìÑ LICENCE - Apply</b><br/><br/>1. Find Form via:<br/>Eli FORMS - Quick Links<br/>OR SDRC Website: Permits &amp; Licences<br/>2. Email Form to customer<br/><br/>üìå Eli: Licence Forms"]

    LicensePay --> CustomerDetails
    LicenseApply --> CustomerDetails`,
    'claims': `    OtherDecision -->|Claims| ClaimsRoute["<b>‚ö†Ô∏è DAMAGE OR INJURY CLAIMS</b><br/><br/>Instruct customer to include:<br/>Name, Time, Location of incident,<br/>Nature of injury/damage,<br/>Evidence: photos, witnesses, etc.<br/><br/>Send Letter of Demand:<br/>Personal/Property Damage:<br/>Subject - ATTN: CEO<br/><br/>Road Related Damage:<br/>Subject - ATTN: Governance<br/><br/>üìå Eli: Claims Process"]

    %% =============================================

    ClaimsRoute --> CustomerDetails`,
    };

    // ‚îÄ‚îÄ Rebuild & render ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    let renderTimer = null;

    window.rebuildDiagram = function() {
        clearTimeout(renderTimer);
        document.getElementById('statusBar').classList.add('show');

        renderTimer = setTimeout(async () => {
            const checked = Object.keys(SECTIONS).filter(k => {
                const cb = document.getElementById('cb_' + k);
                return cb && cb.checked;
            });

            if (checked.length === 0) {
                document.getElementById('mermaidDiagram').innerHTML =
                    '<div class="rendering-msg">‚òëÔ∏è Select at least one service to display the diagram.</div>';
                document.getElementById('statusBar').classList.remove('show');
                return;
            }

            // Which categories are needed?
            const neededCats = [...new Set(checked.map(k => SERVICE_CAT[k]))];
            const catLines = neededCats.map(c => CAT_ENTRIES[c]).join('\n');

            // Build body sections
            const bodyLines = checked.map(k => SECTIONS[k]).join('\n\n');

            const source = HEADER + '\n' + catLines + '\n\n' + bodyLines + '\n\n' + TAIL;

            await window.renderDiagram(source);
            document.getElementById('statusBar').classList.remove('show');
            resetZoom();
        }, 300);
    };

    // ‚îÄ‚îÄ Category toggle ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    window.toggleCat = function(cat, state) {
        document.querySelectorAll(`input[data-cat="${cat}"]`).forEach(cb => {
            cb.checked = state;
        });
        rebuildDiagram();
    };

    // ‚îÄ‚îÄ Zoom ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    let currentZoom = 100;
    const zoomStep = 15;

    function updateZoom() {
        const el = document.getElementById('mermaidDiagram');
        el.style.transform = `scale(${currentZoom / 100})`;
        document.getElementById('zoomLevel').textContent = currentZoom;
    }
    function zoomIn()    { if (currentZoom < 200) { currentZoom += zoomStep; updateZoom(); } }
    function zoomOut()   { if (currentZoom > 25)  { currentZoom -= zoomStep; updateZoom(); } }
    function resetZoom() { currentZoom = 100; updateZoom(); }
    function fitToScreen() { currentZoom = 60; updateZoom(); }

    // ‚îÄ‚îÄ Save as image ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    function showImgOptions() { document.getElementById('imgOptions').classList.add('show'); }
    function hideImgOptions() {
        document.getElementById('imgOptions').classList.remove('show');
        document.getElementById('imgStatus').textContent = '';
    }
    // Shared helper: get SVG clone + dimensions
    function getSvgData() {
        const container = document.getElementById('mermaidDiagram');
        const svg = container.querySelector('svg');
        if (!svg) return null;
        const origTransform = container.style.transform;
        container.style.transform = 'none';
        const svgClone = svg.cloneNode(true);
        const svgWidth  = parseFloat(svg.getAttribute('width')  || svg.viewBox.baseVal.width  || 2000);
        const svgHeight = parseFloat(svg.getAttribute('height') || svg.viewBox.baseVal.height || 3000);
        svgClone.setAttribute('width',  svgWidth);
        svgClone.setAttribute('height', svgHeight);
        container.style.transform = origTransform;
        return { svgClone, svgWidth, svgHeight };
    }

    // SVG download ‚Äî vector, no size limit, perfect for printing
    function saveSVG() {
        const statusEl = document.getElementById('svgStatus');
        const data = getSvgData();
        if (!data) { statusEl.textContent = '‚ö†Ô∏è No diagram rendered yet.'; return; }
        const { svgClone } = data;
        const serialiser = new XMLSerializer();
        const svgString = serialiser.serializeToString(svgClone);
        const blob = new Blob([svgString], { type: 'image/svg+xml;charset=utf-8' });
        const link = document.createElement('a');
        link.download = 'SDRC_CallFlow.svg';
        link.href = URL.createObjectURL(blob);
        link.click();
        statusEl.textContent = '‚úÖ SVG downloaded! Open in Chrome to print, or in Inkscape/Illustrator to export PNG at any size.';
    }

    // PNG download ‚Äî auto-scales to max canvas limit if needed
    async function saveImage() {
        const scale = parseFloat(document.getElementById('imgSize').value);
        const statusEl = document.getElementById('imgStatus');
        statusEl.textContent = '‚è≥ Preparing image' + (scale >= 4 ? ' ‚Äî high-res may take 20-60 seconds...' : '...');

        const container = document.getElementById('mermaidDiagram');
        const svg = container.querySelector('svg');
        if (!svg) { statusEl.textContent = '\u26a0\ufe0f No diagram rendered yet.'; return; }

        // Temporarily remove transform so html2canvas captures at natural size
        const origTransform = container.style.transform;
        container.style.transform = 'none';

        try {
            // html2canvas re-renders the live DOM, bypassing the SVG foreignObject tainted canvas restriction
            const canvas = await html2canvas(container, {
                scale: scale,
                backgroundColor: '#ffffff',
                useCORS: true,
                allowTaint: false,
                logging: false,
                width:  container.scrollWidth,
                height: container.scrollHeight
            });

            container.style.transform = origTransform;

            const w = canvas.width;
            const h = canvas.height;
            statusEl.textContent = `\u23f3 Encoding ${w}\xd7${h}px image...`;
            await new Promise(r => setTimeout(r, 30));

            canvas.toBlob(blob => {
                const link = document.createElement('a');
                link.download = `SDRC_CallFlow_${scale}x.png`;
                link.href = URL.createObjectURL(blob);
                link.click();
                statusEl.textContent = `\u2705 Downloaded at ${scale}x (${w}\xd7${h}px)!`;
            }, 'image/png', 1.0);

        } catch(e) {
            container.style.transform = origTransform;
            console.error(e);
            statusEl.textContent = '\u274c Error: ' + e.message;
        }
    }

    // ‚îÄ‚îÄ Pan & scroll ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const dc = document.getElementById('diagramContainer');
    let isDragging = false, startX, startY, scrollLeft, scrollTop;
    dc.addEventListener('mousedown', e => {
        isDragging = true;
        startX = e.pageX - dc.offsetLeft; startY = e.pageY - dc.offsetTop;
        scrollLeft = dc.scrollLeft; scrollTop = dc.scrollTop;
    });
    dc.addEventListener('mouseleave', () => isDragging = false);
    dc.addEventListener('mouseup',    () => isDragging = false);
    dc.addEventListener('mousemove', e => {
        if (!isDragging) return;
        e.preventDefault();
        dc.scrollLeft = scrollLeft - (e.pageX - dc.offsetLeft - startX) * 1.5;
        dc.scrollTop  = scrollTop  - (e.pageY - dc.offsetTop  - startY) * 1.5;
    });
    dc.addEventListener('wheel', e => {
        if (e.ctrlKey) { e.preventDefault(); e.deltaY < 0 ? zoomIn() : zoomOut(); }
    }, { passive: false });

    document.addEventListener('keydown', e => {
        if (e.ctrlKey && (e.key === '=' || e.key === '+')) { e.preventDefault(); zoomIn(); }
        if (e.ctrlKey && e.key === '-') { e.preventDefault(); zoomOut(); }
        if (e.ctrlKey && e.key === '0') { e.preventDefault(); resetZoom(); }
    });
</script>
</body>
    </html>
