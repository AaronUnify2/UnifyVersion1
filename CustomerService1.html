<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SDRC Call Flow - Landscape Mode</title>
    
    <style>
        * { box-sizing: border-box; }
        body { font-family: 'Segoe UI', Arial, sans-serif; margin: 0; padding: 0; background-color: #f4f6f8; height: 100vh; display: flex; flex-direction: column; }
        
        /* Header */
        header { background: #2c3e50; color: white; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); z-index: 20; }
        h1 { margin: 0; font-size: 22px; font-weight: 600; }
        .subtitle { font-size: 13px; opacity: 0.8; }
        
        /* Layout */
        .main-layout { display: flex; flex: 1; overflow: hidden; }
        
        /* Sidebar */
        .sidebar { width: 320px; /* Widened to accommodate full text */ background: white; border-right: 1px solid #e0e0e0; overflow-y: auto; display: flex; flex-direction: column; z-index: 10; box-shadow: 2px 0 5px rgba(0,0,0,0.05); }
        .sidebar-section { padding: 15px 20px; border-bottom: 1px solid #eee; }
        .sidebar-title { font-size: 13px; font-weight: 700; color: #34495e; text-transform: uppercase; margin-bottom: 10px; letter-spacing: 0.5px; }
        
        .system-item { display: flex; align-items: baseline; margin-bottom: 12px; font-size: 13px; line-height: 1.4; }
        .system-name { font-weight: 700; color: #2980b9; width: 80px; flex-shrink: 0; }
        .system-desc { color: #555; }
        
        /* Diagram Area */
        .diagram-wrapper { flex: 1; position: relative; background-color: #f4f6f8; overflow: hidden; }
        .diagram-container { width: 100%; height: 100%; overflow: hidden; cursor: grab; display: flex; align-items: center; justify-content: center; }
        .diagram-container:active { cursor: grabbing; }
        
        /* Controls */
        .controls-overlay { position: absolute; bottom: 30px; right: 30px; background: white; padding: 8px; border-radius: 50px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); display: flex; gap: 8px; z-index: 100; }
        .btn-control { width: 36px; height: 36px; border-radius: 50%; border: none; background: #fff; color: #555; font-size: 16px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .btn-control:hover { background: #2980b9; color: white; }
        .btn-save { background: #e8f5e9; color: #2e7d32; }
        .btn-save:hover { background: #2e7d32; color: white; }

        /* Mermaid Specifics */
        .mermaid { transform-origin: center center; }
        
    </style>
</head>
<body>

    <header>
        <div>
            <h1>SDRC Service Flow</h1>
            <div class="subtitle">Landscape Mode (Wide)</div>
        </div>
        <div style="font-size: 12px; background: rgba(255,255,255,0.1); padding: 4px 12px; border-radius: 20px;">
            Zoom: <span id="zoomLevel">100</span>%
        </div>
    </header>

    <div class="main-layout">
        <aside class="sidebar">
            <div class="sidebar-section">
                <div class="sidebar-title">üîë Key Systems Reference</div>
                
                <div class="system-item">
                    <span class="system-name">Merit</span> 
                    <span class="system-desc">Customer Request Management System</span>
                </div>
                <div class="system-item">
                    <span class="system-name">TechOne</span> 
                    <span class="system-desc">Financial &amp; Property System</span>
                </div>
                <div class="system-item">
                    <span class="system-name">Intramaps</span> 
                    <span class="system-desc">Geographic Information System (GIS)</span>
                </div>
                <div class="system-item">
                    <span class="system-name">ECM</span> 
                    <span class="system-desc">Enterprise Content Management</span>
                </div>
                <div class="system-item">
                    <span class="system-name">Aqualas</span> 
                    <span class="system-desc">Water Network System</span>
                </div>
                <div class="system-item">
                    <span class="system-name">BPOINT</span> 
                    <span class="system-desc">Payment Processing</span>
                </div>
                <div class="system-item">
                    <span class="system-name">Payreq</span> 
                    <span class="system-desc">Rates Notice System</span>
                </div>
                <div class="system-item">
                    <span class="system-name">Eli</span> 
                    <span class="system-desc">Internal Knowledge Base</span>
                </div>
                <div class="system-item">
                    <span class="system-name">The Pulse</span> 
                    <span class="system-desc">Staff Directory</span>
                </div>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Critical Numbers</div>
                <div class="system-item"><span class="system-name">RSPCA</span> 1300 264 625</div>
                <div class="system-item"><span class="system-name">QLD Rail</span> 13 16 17</div>
                <div class="system-item"><span class="system-name">TMR</span> 13 20 80</div>
            </div>
            
            <div style="padding: 20px; font-size: 12px; background: #fff8e1; border-top: 1px solid #ffe0b2;">
                <b>üí° Tip:</b><br/>This layout flows Left-to-Right.<br/>Scroll wheel to zoom.
            </div>
        </aside>

        <div class="diagram-wrapper">
            <div class="controls-overlay">
                <button class="btn-control" onclick="window.zoomIn()" title="Zoom In">Ôºã</button>
                <button class="btn-control" onclick="window.resetZoom()" title="Reset View">‚ü≤</button>
                <button class="btn-control" onclick="window.zoomOut()" title="Zoom Out">Ôºç</button>
                <div style="width: 1px; background: #eee; height: 20px; align-self: center;"></div>
                <button class="btn-control btn-save" onclick="window.saveImage()" title="Save High-Res Image">üì∑</button>
            </div>

            <div class="diagram-container" id="diagramContainer">
                <div class="mermaid" id="mermaidDiagram">
flowchart LR
    %% --- STYLING ---
    classDef startNode fill:#2e7d32,stroke:#1b5e20,stroke-width:3px,color:white,font-size:15px,font-weight:bold;
    classDef routerNode fill:#ff9800,stroke:#e65100,stroke-width:2px,color:white,font-weight:bold;
    classDef actionNode fill:#ffffff,stroke:#90a4ae,stroke-width:1px,color:#333,text-align:left;
    classDef stopNode fill:#c62828,stroke:#b71c1c,stroke-width:2px,color:white,font-weight:bold;

    %% --- MAIN FLOW (Left to Right) ---

    subgraph INTAKE [Incoming Stage]
        direction TB
        Start([Incoming Call]) --> Greeting["<b>üó£Ô∏è GREETING</b><br/>'SDRC, this is [Name]...'"]
        Greeting --> Verify["<b>üïµÔ∏è VERIFY</b><br/>1. Listen<br/>2. ID Check"]
        Verify --> MainRoute{CATEGORY?}
    end

    %% --- BRANCHES (Stacked Vertically, Flowing Right) ---

    %% 1. ANIMALS
    MainRoute -->|Animals| AnimalSplit{Issue?}
    subgraph SG_Animals [üêï ANIMAL SERVICES]
        direction TB
        AnimalSplit --Lost/Impound--> Anim_Lost["<b>Lost/Found</b><br/>‚Ä¢ Reg: <i>S:\...Animals</i><br/>‚Ä¢ Notify Local Laws<br/><b>Impound</b><br/>‚Ä¢ Check Register<br/>‚Ä¢ Arrange Fee"]
        AnimalSplit --Registration--> Anim_Reg["<b>Registration</b><br/>‚Ä¢ Email Form<br/>‚Ä¢ Proof of Desexing"]
        AnimalSplit --Barking--> Anim_Bark["<b>Barking</b><br/>‚Ä¢ Fact Sheet + Diary<br/>‚Ä¢ Merit 'Barking'"]
        AnimalSplit --Cruelty--> Anim_RSPCA["<b>Cruelty</b><br/>üö® RSPCA: 1300 264 625"]
        AnimalSplit --Attack--> Anim_Attack["<b>‚ö†Ô∏è ATTACK</b><br/>Merit 'attack'<br/>‚Ä¢ Danger present?<br/>‚Ä¢ Medical needed?"]
    end

    %% 2. PROPERTY
    MainRoute -->|Prop/Plan| PropSplit{Issue?}
    subgraph SG_Property [üèóÔ∏è PROPERTY]
        direction TB
        PropSplit --Building--> Prop_Build["<b>Building</b><br/>‚Ä¢ New: Factsheet<br/>‚Ä¢ Insp: Email <i>build...</i>"]
        PropSplit --Plumbing--> Prop_Plumb["<b>Plumbing</b><br/>‚Ä¢ New: FAQ<br/>‚Ä¢ Insp: Calendar"]
        PropSplit --Water--> Prop_Conn["<b>Connect Water</b><br/>Check <b>Intramaps</b><br/>‚Ä¢ Std: Email App<br/>‚Ä¢ Non: Pvt Works"]
        PropSplit --Leak--> Prop_Leak["<b>Leak</b><br/>Check <b>Aqualas</b><br/>‚Ä¢ Council: Merit<br/>‚Ä¢ Cust: Plumber"]
        PropSplit --Planning--> Plan["<b>Planning</b><br/>‚Ä¢ General: Merit<br/>‚Ä¢ Trans: Duty Planner"]
    end

    %% 3. FINANCE
    MainRoute -->|Finance| FinSplit{Issue?}
    subgraph SG_Finance [üí∞ FINANCE]
        direction TB
        FinSplit --Rates--> Fin_Rates["<b>Rates (ID Check)</b><br/>‚Ä¢ Bal: TechOne<br/>‚Ä¢ Copy: Payreq<br/>‚Ä¢ Pens: Form"]
        FinSplit --Payment--> Fin_Pay["<b>Payment</b><br/>‚Ä¢ BPOINT<br/>‚Ä¢ Ref: Prop ID"]
    end

    %% 4. WASTE & ROADS
    MainRoute -->|Waste| WasteSplit{Issue?}
    subgraph SG_Waste [üóëÔ∏è WASTE / ROADS]
        direction TB
        WasteSplit --Bins--> Waste_Bins["<b>Bins</b><br/>‚Ä¢ Broken: Cleanaway<br/>‚Ä¢ Public: Merit"]
        WasteSplit --Roads--> Roads["<b>Roads</b><br/>‚Ä¢ Closed: Dashboard<br/>‚Ä¢ Pot: Merit<br/>‚Ä¢ Hwy: TMR"]
    end

    %% 5. GENERAL
    MainRoute -->|General| GenSplit{Issue?}
    subgraph SG_General [üîß GENERAL]
        direction TB
        GenSplit --Camp--> Camp["<b>Campgrounds</b><br/>‚Ä¢ Washpool: Eli<br/>‚Ä¢ Connolly: Site"]
        GenSplit --Env--> Env["<b>Env Health</b><br/>‚Ä¢ Jurisdiction?<br/>‚Ä¢ Nuisance Diary"]
        GenSplit --Other--> Trans["<b>Transfers</b><br/>‚Ä¢ Pulse Search<br/>‚Ä¢ Warm Xfer"]
    end

    %% --- TERMINATORS ---
    
    SG_Animals --> Close(["<b>üëã CLOSE CALL</b><br/>'Anything else?'"])
    SG_Property --> Close
    SG_Finance --> Close
    SG_Waste --> Close
    SG_General --> Close

    %% --- CLASS ASSIGNMENT ---
    class Start startNode;
    class MainRoute,AnimalSplit,PropSplit,FinSplit,WasteSplit,GenSplit routerNode;
    class Close stopNode;
    class Anim_Lost,Anim_Reg,Anim_Bark,Anim_RSPCA,Anim_Attack,Anim_Gen actionNode;
    class Prop_Build,Prop_Plumb,Prop_Conn,Prop_Leak,Plan actionNode;
    class Fin_Rates,Fin_Pay,Fin_Lic actionNode;
    class Waste_Bins,Waste_Public,Waste_Comp,Roads actionNode;
    class Camp,Env,Comp,Disp,Trans actionNode;
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'base',
            flowchart: {
                useMaxWidth: false,
                htmlLabels: true,
                curve: 'basis',
                nodeSpacing: 30,
                rankSpacing: 80,
                padding: 15
            },
            themeVariables: {
                primaryColor: '#e3f2fd',
                secondaryColor: '#fff3e0',
                tertiaryColor: '#e8f5e9',
                fontSize: '14px',
                fontFamily: 'Segoe UI, Arial, sans-serif',
                lineColor: '#546e7a'
            }
        });

        // --- GLOBAL LOGIC ---
        // We attach these to 'window' so the HTML onclick events can find them
        
        let currentZoom = 100;
        const minZoom = 25;
        const maxZoom = 200;
        const zoomStep = 15;
        let isPanning = false;
        let startX = 0;
        let startY = 0;
        let panX = 0;
        let panY = 0;

        function updateTransform() {
            // Find the div that Mermaid inserts. It usually keeps the ID, but we check.
            const mermaidDiv = document.getElementById('mermaidDiagram');
            if(mermaidDiv) {
                mermaidDiv.style.transform = `translate(${panX}px, ${panY}px) scale(${currentZoom / 100})`;
                document.getElementById('zoomLevel').textContent = currentZoom;
            }
        }

        window.zoomIn = function() {
            if (currentZoom < maxZoom) {
                currentZoom += zoomStep;
                updateTransform();
            }
        };

        window.zoomOut = function() {
            if (currentZoom > minZoom) {
                currentZoom -= zoomStep;
                updateTransform();
            }
        };

        window.resetZoom = function() {
            currentZoom = 100;
            panX = 0;
            panY = 0;
            updateTransform();
        };

        window.saveImage = function() {
            const diagramElement = document.getElementById('mermaidDiagram');
            // Look for the inner SVG
            const svg = diagramElement.querySelector('svg');
            
            if (!svg) {
                alert('Diagram is not fully loaded yet. Please wait a second.');
                return;
            }

            const serializer = new XMLSerializer();
            let source = serializer.serializeToString(svg);

            // Safety Fix: Ensure namespace exists for valid XML
            if(!source.match(/^<svg[^>]+xmlns="http\:\/\/www\.w3\.org\/2000\/svg"/)){
                source = source.replace(/^<svg/, '<svg xmlns="http://www.w3.org/2000/svg"');
            }

            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            
            // Get size from bounding box because viewBox might be unset in some mermaid versions
            const box = svg.getBoundingClientRect();
            
            // High Resolution Scale (3x)
            const scaleFactor = 3; 
            canvas.width = box.width * scaleFactor;
            canvas.height = box.height * scaleFactor;

            const img = new Image();
            img.src = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(source)));

            img.onload = function() {
                // White background
                context.fillStyle = '#ffffff';
                context.fillRect(0, 0, canvas.width, canvas.height);
                // Draw
                context.drawImage(img, 0, 0, canvas.width, canvas.height);
                
                // Download
                const a = document.createElement('a');
                a.download = 'SDRC_Flowchart.png';
                a.href = canvas.toDataURL('image/png');
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            };
            
            img.onerror = function() {
                alert('Error generating image. This may be due to browser security restrictions on local files.');
            };
        };

        // --- PANNING EVENTS ---
        const container = document.getElementById('diagramContainer');

        container.addEventListener('wheel', function(e) {
            if (e.ctrlKey || e.metaKey) {
                e.preventDefault();
                if (e.deltaY < 0) window.zoomIn();
                else window.zoomOut();
            }
        });

        container.addEventListener('mousedown', (e) => {
            isPanning = true;
            startX = e.clientX - panX;
            startY = e.clientY - panY;
            container.style.cursor = 'grabbing';
        });

        window.addEventListener('mouseup', () => {
            isPanning = false;
            container.style.cursor = 'grab';
        });

        window.addEventListener('mousemove', (e) => {
            if (!isPanning) return;
            e.preventDefault();
            panX = e.clientX - startX;
            panY = e.clientY - startY;
            updateTransform();
        });
    </script>
</body>
</html>
