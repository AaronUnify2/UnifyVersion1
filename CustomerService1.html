<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SDRC Call Flow - Landscape Mode</title>
    
    <style>
        * { box-sizing: border-box; }
        body { font-family: 'Segoe UI', Arial, sans-serif; margin: 0; padding: 0; background-color: #f4f6f8; height: 100vh; display: flex; flex-direction: column; }
        
        /* Header */
        header { background: #2c3e50; color: white; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); z-index: 20; }
        h1 { margin: 0; font-size: 22px; font-weight: 600; }
        .subtitle { font-size: 13px; opacity: 0.8; }
        
        /* Layout */
        .main-layout { display: flex; flex: 1; overflow: hidden; }
        
        /* Sidebar */
        .sidebar { width: 280px; background: white; border-right: 1px solid #e0e0e0; overflow-y: auto; display: flex; flex-direction: column; z-index: 10; box-shadow: 2px 0 5px rgba(0,0,0,0.05); }
        .sidebar-section { padding: 15px 20px; border-bottom: 1px solid #eee; }
        .sidebar-title { font-size: 13px; font-weight: 700; color: #34495e; text-transform: uppercase; margin-bottom: 10px; letter-spacing: 0.5px; }
        
        .system-item { display: flex; align-items: baseline; margin-bottom: 8px; font-size: 12px; }
        .system-name { font-weight: 700; color: #2980b9; width: 80px; flex-shrink: 0; }
        .system-desc { color: #555; }
        
        /* Diagram Area */
        .diagram-wrapper { flex: 1; position: relative; background-color: #f4f6f8; overflow: hidden; }
        .diagram-container { width: 100%; height: 100%; overflow: hidden; cursor: grab; display: flex; align-items: center; justify-content: center; }
        .diagram-container:active { cursor: grabbing; }
        
        /* Controls */
        .controls-overlay { position: absolute; bottom: 30px; right: 30px; background: white; padding: 8px; border-radius: 50px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); display: flex; gap: 8px; z-index: 100; }
        .btn-control { width: 36px; height: 36px; border-radius: 50%; border: none; background: #fff; color: #555; font-size: 16px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .btn-control:hover { background: #2980b9; color: white; }
        .btn-save { background: #e8f5e9; color: #2e7d32; }
        .btn-save:hover { background: #2e7d32; color: white; }

        /* Mermaid Specifics */
        .mermaid { transform-origin: center center; }
        
    </style>
</head>
<body>

    <header>
        <div>
            <h1>SDRC Service Flow</h1>
            <div class="subtitle">Comprehensive "New Hire" Landscape View</div>
        </div>
        <div style="font-size: 12px; background: rgba(255,255,255,0.1); padding: 4px 12px; border-radius: 20px;">
            Zoom: <span id="zoomLevel">100</span>%
        </div>
    </header>

    <div class="main-layout">
        <aside class="sidebar">
            <div class="sidebar-section">
                <div class="sidebar-title">Key Systems</div>
                <div class="system-item"><span class="system-name">Merit</span> Request Mgmt</div>
                <div class="system-item"><span class="system-name">TechOne</span> Finance/Prop</div>
                <div class="system-item"><span class="system-name">Intramaps</span> GIS / Maps</div>
                <div class="system-item"><span class="system-name">ECM</span> Documents</div>
                <div class="system-item"><span class="system-name">Aqualas</span> Water Networks</div>
                <div class="system-item"><span class="system-name">BPOINT</span> Payments</div>
                <div class="system-item"><span class="system-name">Payreq</span> Rates Notices</div>
                <div class="system-item"><span class="system-name">Eli</span> Knowledge Base</div>
                <div class="system-item"><span class="system-name">The Pulse</span> Staff Directory</div>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Critical Numbers</div>
                <div class="system-item"><span class="system-name">RSPCA</span> 1300 264 625</div>
                <div class="system-item"><span class="system-name">QLD Rail</span> 13 16 17</div>
                <div class="system-item"><span class="system-name">TMR</span> 13 20 80</div>
                <div class="system-item"><span class="system-name">Washpool</span> 0427 026 216</div>
            </div>
            
            <div style="padding: 20px; font-size: 12px; background: #fff8e1; border-top: 1px solid #ffe0b2;">
                <b>üí° New Hire Tips:</b><br/>
                ‚Ä¢ Never cold transfer.<br/>
                ‚Ä¢ ID Check for Rates/Private.<br/>
                ‚Ä¢ Hold is better than guessing.
            </div>
        </aside>

        <div class="diagram-wrapper">
            <div class="controls-overlay">
                <button class="btn-control" onclick="window.zoomIn()" title="Zoom In">Ôºã</button>
                <button class="btn-control" onclick="window.resetZoom()" title="Reset View">‚ü≤</button>
                <button class="btn-control" onclick="window.zoomOut()" title="Zoom Out">Ôºç</button>
                <div style="width: 1px; background: #eee; height: 20px; align-self: center;"></div>
                <button class="btn-control btn-save" onclick="window.saveImage()" title="Save High-Res Image">üì∑</button>
            </div>

            <div class="diagram-container" id="diagramContainer">
                <div class="mermaid" id="mermaidDiagram">
flowchart LR
    %% --- STYLING ---
    classDef startNode fill:#2e7d32,stroke:#1b5e20,stroke-width:3px,color:white,font-size:15px,font-weight:bold;
    classDef routerNode fill:#ff9800,stroke:#e65100,stroke-width:2px,color:white,font-weight:bold;
    classDef actionNode fill:#ffffff,stroke:#90a4ae,stroke-width:1px,color:#333,text-align:left;
    classDef stopNode fill:#c62828,stroke:#b71c1c,stroke-width:2px,color:white,font-weight:bold;

    %% --- MAIN FLOW ---

    subgraph INTAKE [Incoming Stage]
        direction TB
        Start([Incoming Call]) --> Greeting["<b>üó£Ô∏è GREETING</b><br/>'SDRC, this is [Name] speaking.<br/>How can I help you today?'"]
        Greeting --> Verify["<b>üïµÔ∏è VERIFY & IDENTIFY</b><br/>1. Listen to reason<br/>2. <b>Verify Identity</b>"]
        Verify --> MainRoute{CATEGORY?}
    end

    %% --- BRANCHES ---

    %% 1. ANIMALS
    MainRoute -->|Animals| AnimalSplit{Issue?}
    subgraph SG_Animals [üêï ANIMAL SERVICES]
        direction TB
        AnimalSplit --Lost/Impound--> Anim_Lost["<b>Lost & Found:</b> Add to S:\...Animals Register. Notify Local Laws.<br/><b>Impounded:</b> Check S:\...Impoundments. Contact Officer. Arrange fee."]
        AnimalSplit --Registration--> Anim_Reg["<b>Dog Registration:</b> Email Form.<br/>Request: Desex proof, Pension, or Breeder #"]
        AnimalSplit --Barking--> Anim_Bark["<b>Barking (NEW):</b> Merit 'Barking' + Fact Sheet/Diary.<br/><b>Ongoing:</b> Add Note to Merit + Phone #"]
        AnimalSplit --Cruelty--> Anim_RSPCA["<b>Cruelty/Welfare:</b><br/>üö® RSPCA: 1300 264 625"]
        AnimalSplit --Attack--> Anim_Attack["<b>‚ö†Ô∏è DOG ATTACK:</b> Merit 'attack'.<br/>Record: Danger present? Dog location?<br/>Medical needed? Date/Time.<br/>üìß Email 'Statement of Attack' Form"]
    end

    %% 2. PROPERTY
    MainRoute -->|Prop/Plan| PropSplit{Issue?}
    subgraph SG_Property [üèóÔ∏è PROPERTY & PLANNING]
        direction TB
        PropSplit --Building--> Prop_Build["<b>Building:</b> New -> Merit 'Building'.<br/>Insp: Email <i>buildinginspections@sdrc</i>"]
        PropSplit --Plumbing--> Prop_Plumb["<b>Plumbing:</b> Insp: Check Cal -> Add -> Notify <i>plumbinginspections@sdrc</i>"]
        PropSplit --Water--> Prop_Conn["<b>Water Connection:</b> Check Intramaps.<br/>Standard? Email 'App for Water'.<br/>Non-Std? Email 'Private Works'"]
        PropSplit --Leak--> Prop_Leak["<b>Water Leak:</b> Check Aqualas.<br/>Council side: Merit 'Leak'.<br/>Customer side: Advise Plumber."]
        PropSplit --Planning--> Plan["<b>Planning:</b> New -> Merit.<br/>Specifics -> Transfer to Duty Planner."]
    end

    %% 3. FINANCE
    MainRoute -->|Finance| FinSplit{Issue?}
    subgraph SG_Finance [üí∞ FINANCE]
        direction TB
        FinSplit --Rates--> Fin_Rates["<b>Rates (ID CHECK):</b> Bal: TechOne.<br/>Copy: Payreq PDF. Pension: Email Form."]
        FinSplit --Payment--> Fin_Pay["<b>BPOINT:</b> Need Name, Addr, Purpose.<br/>Ref: Property ID or Licence #"]
    end

    %% 4. WASTE & ROADS
    MainRoute -->|Waste/Roads| WasteSplit{Issue?}
    subgraph SG_Waste [üóëÔ∏è INFRASTRUCTURE]
        direction TB
        WasteSplit --Bins--> Waste_Bins["<b>Bins:</b> Missed/Broken -> Lodge Cleanaway.<br/>Public: Check Intramaps for icon."]
        WasteSplit --Roads--> Roads["<b>Roads:</b> Closures: Disaster Dashboard.<br/>Hwy: TMR. Rail: QLD Rail.<br/>Pothole: Merit (Sealed/Unsealed)"]
    end

    %% 5. GENERAL
    MainRoute -->|General| GenSplit{Issue?}
    subgraph SG_General [üîß GENERAL]
        direction TB
        GenSplit --Camp--> Camp["<b>Camp:</b> Washpool: Vicki (0427 026 216).<br/>Connolly: Self-register."]
        GenSplit --Env--> Env["<b>Env Health:</b> Merit 'Environment'.<br/>Ongoing? Email 'Nuisance Diary'."]
        GenSplit --Other--> Trans["<b>Transfers:</b> Search Pulse/Eli.<br/>Warm Transfer (Announce).<br/>Unavail: Merit Callback."]
    end

    %% --- TERMINATORS ---
    SG_Animals --> Close(["<b>üëã CLOSE CALL</b><br/>'Anything else?'"])
    SG_Property --> Close
    SG_Finance --> Close
    SG_Waste --> Close
    SG_General --> Close

    %% --- CLASS ASSIGNMENT ---
    class Start startNode;
    class MainRoute,AnimalSplit,PropSplit,FinSplit,WasteSplit,GenSplit routerNode;
    class Close stopNode;
    class Anim_Lost,Anim_Reg,Anim_Bark,Anim_RSPCA,Anim_Attack actionNode;
    class Prop_Build,Prop_Plumb,Prop_Conn,Prop_Leak,Plan actionNode;
    class Fin_Rates,Fin_Pay actionNode;
    class Waste_Bins,Roads actionNode;
    class Camp,Env,Trans actionNode;
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'base',
            flowchart: {
                useMaxWidth: false,
                htmlLabels: true,
                curve: 'basis',
                nodeSpacing: 30,
                rankSpacing: 80,
                padding: 15
            },
            themeVariables: {
                primaryColor: '#e3f2fd',
                secondaryColor: '#fff3e0',
                tertiaryColor: '#e8f5e9',
                fontSize: '13px',
                fontFamily: 'Segoe UI, Arial, sans-serif',
                lineColor: '#546e7a'
            }
        });

        let currentZoom = 100;
        const minZoom = 25;
        const maxZoom = 200;
        const zoomStep = 15;
        let isPanning = false;
        let startX = 0;
        let startY = 0;
        let panX = 0;
        let panY = 0;

        function updateTransform() {
            const mermaidDiv = document.getElementById('mermaidDiagram');
            if(mermaidDiv) {
                mermaidDiv.style.transform = `translate(${panX}px, ${panY}px) scale(${currentZoom / 100})`;
                document.getElementById('zoomLevel').textContent = currentZoom;
            }
        }

        window.zoomIn = function() {
            if (currentZoom < maxZoom) {
                currentZoom += zoomStep;
                updateTransform();
            }
        };

        window.zoomOut = function() {
            if (currentZoom > minZoom) {
                currentZoom -= zoomStep;
                updateTransform();
            }
        };

        window.resetZoom = function() {
            currentZoom = 100;
            panX = 0;
            panY = 0;
            updateTransform();
        };

        window.saveImage = function() {
            const diagramElement = document.getElementById('mermaidDiagram');
            const svg = diagramElement.querySelector('svg');
            if (!svg) return;

            const serializer = new XMLSerializer();
            let source = serializer.serializeToString(svg);
            if(!source.match(/^<svg[^>]+xmlns="http\:\/\/www\.w3\.org\/2000\/svg"/)){
                source = source.replace(/^<svg/, '<svg xmlns="http://www.w3.org/2000/svg"');
            }

            const canvas = document.createElement('canvas');
            const box = svg.getBoundingClientRect();
            const scaleFactor = 2; 
            canvas.width = box.width * scaleFactor;
            canvas.height = box.height * scaleFactor;

            const img = new Image();
            img.src = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(source)));

            img.onload = function() {
                const context = canvas.getContext('2d');
                context.fillStyle = '#ffffff';
                context.fillRect(0, 0, canvas.width, canvas.height);
                context.drawImage(img, 0, 0, canvas.width, canvas.height);
                const a = document.createElement('a');
                a.download = 'SDRC_Flowchart_Detailed.png';
                a.href = canvas.toDataURL('image/png');
                a.click();
            };
        };

        const container = document.getElementById('diagramContainer');
        container.addEventListener('mousedown', (e) => {
            isPanning = true;
            startX = e.clientX - panX;
            startY = e.clientY - panY;
            container.style.cursor = 'grabbing';
        });
        window.addEventListener('mouseup', () => { isPanning = false; container.style.cursor = 'grab'; });
        window.addEventListener('mousemove', (e) => {
            if (!isPanning) return;
            panX = e.clientX - startX;
            panY = e.clientY - startY;
            updateTransform();
        });
    </script>
</body>
</html>
