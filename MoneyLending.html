<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unify - Contracts</title>
    <style>
        /* === RESET & BASE === */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #000;
            color: #fff;
            line-height: 1.6;
            min-height: 100vh;
        }

        /* === LAYOUT === */
        .container {
            background: #0f0f0f;
            min-height: 100vh;
            padding: 0;
            margin: 0;
        }

        .header {
            background: #050505;
            border: 2px solid #123456;
            padding: 1rem;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .content {
            padding: 1rem;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* === TYPOGRAPHY === */
        h1 {
            color: #fbfbfb;
            font-size: clamp(1.5rem, 4vw, 3rem);
            margin-bottom: 0.5rem;
        }

        h2 {
            color: #fbfbfb;
            font-size: clamp(1.2rem, 3vw, 2rem);
            margin-bottom: 0.25rem;
        }

        h3 {
            color: #000;
            font-size: clamp(1.1rem, 2.5vw, 1.5rem);
            text-align: center;
            margin-bottom: 1rem;
        }

        h4 {
            color: #fbfbfb;
            font-size: clamp(1rem, 2vw, 1.2rem);
        }

        p {
            margin: 1rem 0;
        }

        a {
            color: #fbfbfb;
            text-decoration: none;
        }

        /* === SECTION PANELS === */
        .section-toggle {
            background: rgba(255, 255, 255, 0.97);
            color: #000;
            padding: 1rem;
            margin: 1rem 0;
            border: 2px solid #123456;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1rem;
            text-align: center;
            transition: all 0.3s ease;
            user-select: none;
        }

        .section-toggle:hover {
            background: rgba(255, 255, 255, 0.9);
            transform: translateY(-2px);
        }

        .section-toggle:active {
            transform: translateY(0);
        }

        .section-panel {
            display: none;
            background: #305a00;
            border-radius: 12px;
            padding: 1rem;
            margin: 1rem 0;
            border: 2px solid #123456;
        }

        .section-panel.active {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .form-content {
            background: #fbfbfb;
            color: #000;
            padding: 1.5rem;
            border-radius: 8px;
            border: 2px solid rgba(70, 150, 32, 0.78);
        }

        /* === FORM ELEMENTS === */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-row {
            display: grid;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        @media (min-width: 768px) {
            .form-row.two-col {
                grid-template-columns: 1fr 1fr;
            }
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #333;
        }

        input[type="text"],
        input[type="number"],
        input[type="email"],
        input[type="date"],
        select,
        textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #ccc;
            border-radius: 6px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #fff;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        input[type="email"]:focus,
        input[type="date"]:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #305a00;
            box-shadow: 0 0 0 3px rgba(48, 90, 0, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* === BUTTONS === */
        .btn {
            background: #148214;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 48px; /* Better touch target */
            min-width: 120px;
        }

        .btn:hover {
            background: #0f6b0f;
            transform: translateY(-1px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: #5a825a;
        }

        .btn-secondary:hover {
            background: #4a704a;
        }

        .btn-warning {
            background: #c88214;
        }

        .btn-warning:hover {
            background: #a66b11;
        }

        .btn-large {
            padding: 1rem 2rem;
            font-size: 1.1rem;
            min-height: 56px;
        }

        .btn-center {
            display: block;
            margin: 2rem auto;
        }

        /* === SIGNATURE CANVAS === */
        .signature-container {
            margin: 1rem 0;
        }

        .signature-canvas {
            border: 2px solid #c4caac;
            border-radius: 6px;
            width: 100%;
            max-width: 600px;
            height: 120px;
            background: white;
            touch-action: none;
        }

        .signature-controls {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
            flex-wrap: wrap;
        }

        .signature-controls .btn {
            flex: 1;
            min-width: 120px;
        }

        /* === FILE UPLOAD === */
        .file-upload {
            position: relative;
            display: inline-block;
            margin: 1rem 0;
        }

        .file-upload input[type="file"] {
            display: none;
        }

        .file-upload-label {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            background: #148214;
            color: white;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s ease;
            min-height: 48px;
            line-height: 1.5;
        }

        .file-upload-label:hover {
            background: #0f6b0f;
        }

        .image-preview {
            max-width: 100%;
            height: auto;
            margin: 1rem 0;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        /* === DIVIDERS === */
        .divider {
            border: 0;
            height: 1px;
            background: linear-gradient(to right, #f0f0f0, #8c8b8b, #f0f0f0);
            margin: 1.5rem 0;
        }

        /* === PROGRESS INDICATOR === */
        .progress-bar {
            background: #333;
            height: 4px;
            border-radius: 2px;
            margin: 1rem 0;
            overflow: hidden;
        }

        .progress-fill {
            background: #148214;
            height: 100%;
            transition: width 0.3s ease;
            width: 0%;
        }

        /* === CONTRACT PREVIEW === */
        #contract-preview {
            background: white;
            color: black;
            padding: 2rem;
            border-radius: 8px;
            line-height: 1.8;
            display: none;
        }

        #contract-preview.visible {
            display: block;
        }

        .contract-section {
            margin-bottom: 2rem;
        }

        .contract-highlight {
            background: #ffffcc;
            padding: 2px 4px;
            border-radius: 3px;
        }

        /* === RESPONSIVE DESIGN === */
        @media (max-width: 768px) {
            .content {
                padding: 0.5rem;
            }

            .form-content {
                padding: 1rem;
            }

            .signature-controls {
                flex-direction: column;
            }

            .signature-controls .btn {
                flex: none;
            }

            h1 { font-size: 1.8rem; }
            h2 { font-size: 1.4rem; }
            h4 { font-size: 1rem; }
        }

        @media (max-width: 480px) {
            .header {
                padding: 0.5rem;
            }

            .btn {
                padding: 0.6rem 1rem;
                font-size: 0.9rem;
            }

            input, select, textarea {
                font-size: 16px; /* Prevents zoom on iOS */
            }
        }

        /* === UTILITIES === */
        .text-center { text-align: center; }
        .mb-1 { margin-bottom: 1rem; }
        .mt-1 { margin-top: 1rem; }
        .hidden { display: none; }
        .flex { display: flex; }
        .flex-wrap { flex-wrap: wrap; }
        .gap-1 { gap: 1rem; }
        .justify-center { justify-content: center; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><a href="#">Unify - Contracts</a></h1>
            <h2>Money Lending Agreement</h2>
            <h4>Fill out form to generate PDF</h4>
            <div class="progress-bar">
                <div class="progress-fill" id="progress"></div>
            </div>
        </div>

        <div class="content">
            <!-- Section 1: Contact Details -->
            <div class="section-toggle" onclick="toggleSection('section1')">
                1. Contact Details
            </div>
            <div id="section1" class="section-panel">
                <div class="form-content">
                    <h3>Contact Details for Both Parties</h3>
                    <hr class="divider">
                    
                    <h4>Lender Details:</h4>
                    <div class="form-group">
                        <label for="lenderName">Lender Name</label>
                        <input type="text" id="lenderName" placeholder="Enter lender's full name" required>
                    </div>
                    <div class="form-group">
                        <label for="lenderAddress">Lender Address</label>
                        <input type="text" id="lenderAddress" placeholder="Enter lender's address" required>
                    </div>
                    <div class="form-group">
                        <label for="lenderEmail">Lender Email</label>
                        <input type="email" id="lenderEmail" placeholder="Enter lender's email" required>
                    </div>

                    <hr class="divider">

                    <h4>Borrower Details:</h4>
                    <div class="form-group">
                        <label for="borrowerName">Borrower Name</label>
                        <input type="text" id="borrowerName" placeholder="Enter borrower's full name" required>
                    </div>
                    <div class="form-group">
                        <label for="borrowerAddress">Borrower Address</label>
                        <input type="text" id="borrowerAddress" placeholder="Enter borrower's address" required>
                    </div>
                    <div class="form-group">
                        <label for="borrowerEmail">Borrower Email</label>
                        <input type="email" id="borrowerEmail" placeholder="Enter borrower's email" required>
                    </div>

                    <button class="btn btn-center" onclick="saveSection1()">Next</button>
                </div>
            </div>

            <!-- Section 2: Loan Details -->
            <div class="section-toggle" onclick="toggleSection('section2')">
                2. Loan Details
            </div>
            <div id="section2" class="section-panel">
                <div class="form-content">
                    <h3>Details for Loan</h3>
                    <hr class="divider">
                    
                    <div class="form-row two-col">
                        <div class="form-group">
                            <label for="loanAmount">Loan Amount ($)</label>
                            <input type="number" id="loanAmount" placeholder="0.00" min="0" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="interestRate">Interest Rate (%)</label>
                            <input type="number" id="interestRate" placeholder="0.00" min="0" step="0.01" required>
                        </div>
                    </div>

                    <div class="form-row two-col">
                        <div class="form-group">
                            <label for="totalRepayment">Total Repayment ($)</label>
                            <input type="number" id="totalRepayment" placeholder="0.00" min="0" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="repaymentType">Repayment Type</label>
                            <select id="repaymentType" required>
                                <option value="">Select frequency</option>
                                <option value="as a lump sum">Lump Sum</option>
                                <option value="weekly">Weekly</option>
                                <option value="fortnightly">Fortnightly</option>
                                <option value="monthly">Monthly</option>
                                <option value="annually">Annually</option>
                            </select>
                        </div>
                    </div>

                    <hr class="divider">

                    <div class="form-row">
                        <div class="form-group">
                            <label for="transferDate">Date of Loan Transfer</label>
                            <input type="date" id="transferDate" required>
                        </div>
                        <div class="form-group">
                            <label for="startDate">Date of First Payment</label>
                            <input type="date" id="startDate" required>
                        </div>
                        <div class="form-group">
                            <label for="endDate">Date of Last Payment</label>
                            <input type="date" id="endDate" required>
                        </div>
                    </div>

                    <hr class="divider">

                    <div class="form-row two-col">
                        <div class="form-group">
                            <label for="numberRepayments">Number of Repayments</label>
                            <input type="number" id="numberRepayments" placeholder="0" min="1" required>
                        </div>
                        <div class="form-group">
                            <label for="repaymentValue">Repayment Value ($)</label>
                            <input type="number" id="repaymentValue" placeholder="0.00" min="0" step="0.01" required>
                        </div>
                    </div>

                    <button class="btn btn-center" onclick="saveSection2()">Next</button>
                </div>
            </div>

            <!-- Section 3: Collateral Details -->
            <div class="section-toggle" onclick="toggleSection('section3')">
                3. Collateral Details
            </div>
            <div id="section3" class="section-panel">
                <div class="form-content">
                    <h3>Details for Collateral</h3>
                    <hr class="divider">

                    <div class="form-group">
                        <label for="possessionDate">When is possession of collateral transferred?</label>
                        <select id="possessionDate" required>
                            <option value="">Select timing</option>
                            <option value="on the start date of the loan">Start Date</option>
                            <option value="after one missed payment">After Missed Payment</option>
                        </select>
                    </div>

                    <hr class="divider">

                    <div class="form-group">
                        <label>Upload Collateral Image</label>
                        <div class="file-upload">
                            <input type="file" id="collateralImage" accept="image/*" onchange="loadImage(event, 'collateralPreview')">
                            <label for="collateralImage" class="file-upload-label">
                                ðŸ“· Upload Image
                            </label>
                        </div>
                        <img id="collateralPreview" class="image-preview hidden" alt="Collateral preview">
                    </div>

                    <div class="form-group">
                        <label for="collateralDescription">Description of Collateral</label>
                        <textarea id="collateralDescription" placeholder="Detailed description of the collateral..." rows="4" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="collateralCondition">Condition of Collateral until End Date</label>
                        <textarea id="collateralCondition" placeholder="How should the collateral be maintained..." rows="4" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="missedPayment">Ownership transfers after how many missed payments?</label>
                        <input type="number" id="missedPayment" placeholder="Number of missed payments" min="1" required>
                    </div>

                    <button class="btn btn-center" onclick="saveSection3()">Next</button>
                </div>
            </div>

            <!-- Section 4: Guarantor Details -->
            <div class="section-toggle" onclick="toggleSection('section4')">
                4. Guarantor Details
            </div>
            <div id="section4" class="section-panel">
                <div class="form-content">
                    <h3>Guarantor Details</h3>
                    <hr class="divider">

                    <div class="form-group">
                        <label for="hasGuarantor">Is there a guarantor for the loan?</label>
                        <select id="hasGuarantor" onchange="toggleGuarantorFields()" required>
                            <option value="">Select option</option>
                            <option value=" has agreed to act as guarantor for the loan. ">Yes</option>
                            <option value="there is no Guarantor for this loan. ">No</option>
                        </select>
                    </div>

                    <div id="guarantorFields" class="hidden">
                        <div class="form-group">
                            <label for="guarantorName">Guarantor Name</label>
                            <input type="text" id="guarantorName" placeholder="Enter guarantor's full name">
                        </div>
                        <div class="form-group">
                            <label for="guarantorAddress">Guarantor Address</label>
                            <input type="text" id="guarantorAddress" placeholder="Enter guarantor's address">
                        </div>
                        <div class="form-group">
                            <label for="guarantorEmail">Guarantor Email</label>
                            <input type="email" id="guarantorEmail" placeholder="Enter guarantor's email">
                        </div>
                    </div>

                    <button class="btn btn-center" onclick="saveSection4()">Next</button>
                </div>
            </div>

            <!-- Section 5: Review Contract -->
            <div class="section-toggle" onclick="toggleSection('section5')">
                5. Review Contract
            </div>
            <div id="section5" class="section-panel">
                <div class="form-content">
                    <h3>Review Contract</h3>
                    <hr class="divider">
                    
                    <div class="text-center mb-1">
                        <button class="btn btn-large" onclick="generatePreview()">ðŸ“„ Review Contract</button>
                    </div>

                    <div id="contract-preview"></div>

                    <p class="text-center mt-1">
                        <em>Once signed, the contract becomes legally binding. Ensure all details are correct.</em>
                    </p>

                    <button class="btn btn-center" onclick="nextToSignature()">Next</button>
                </div>
            </div>

            <!-- Section 6: Signatures -->
            <div class="section-toggle" onclick="toggleSection('section6')">
                6. Signatures
            </div>
            <div id="section6" class="section-panel">
                <div class="form-content">
                    <h3>Signatures</h3>
                    <hr class="divider">

                    <!-- Lender Signature -->
                    <h4>Lender Signature</h4>
                    <div class="form-group">
                        <label for="lenderNameConfirm">Confirm Lender Name</label>
                        <input type="text" id="lenderNameConfirm" placeholder="Re-enter lender name" required>
                    </div>
                    
                    <div class="signature-container">
                        <canvas id="lenderSignature" class="signature-canvas"></canvas>
                        <div class="signature-controls">
                            <button class="btn btn-warning" onclick="saveSignature('lenderSignature', 'lenderSigSaved')">Save Signature</button>
                            <button class="btn btn-secondary" onclick="clearSignature('lenderSignature')">Clear</button>
                        </div>
                        <img id="lenderSigSaved" class="hidden" alt="Saved signature">
                    </div>

                    <div class="form-group">
                        <label>Lender ID Proof</label>
                        <div class="file-upload">
                            <input type="file" id="lenderID" accept="image/*" onchange="loadImage(event, 'lenderIDPreview')">
                            <label for="lenderID" class="file-upload-label">ðŸ“· Upload ID</label>
                        </div>
                        <img id="lenderIDPreview" class="image-preview hidden" alt="Lender ID">
                    </div>

                    <hr class="divider">

                    <!-- Borrower Signature -->
                    <h4>Borrower Signature</h4>
                    <div class="form-group">
                        <label for="borrowerNameConfirm">Confirm Borrower Name</label>
                        <input type="text" id="borrowerNameConfirm" placeholder="Re-enter borrower name" required>
                    </div>
                    
                    <div class="signature-container">
                        <canvas id="borrowerSignature" class="signature-canvas"></canvas>
                        <div class="signature-controls">
                            <button class="btn btn-warning" onclick="saveSignature('borrowerSignature', 'borrowerSigSaved')">Save Signature</button>
                            <button class="btn btn-secondary" onclick="clearSignature('borrowerSignature')">Clear</button>
                        </div>
                        <img id="borrowerSigSaved" class="hidden" alt="Saved signature">
                    </div>

                    <div class="form-group">
                        <label>Borrower ID Proof</label>
                        <div class="file-upload">
                            <input type="file" id="borrowerID" accept="image/*" onchange="loadImage(event, 'borrowerIDPreview')">
                            <label for="borrowerID" class="file-upload-label">ðŸ“· Upload ID</label>
                        </div>
                        <img id="borrowerIDPreview" class="image-preview hidden" alt="Borrower ID">
                    </div>

                    <hr class="divider">

                    <!-- Guarantor Signature (if applicable) -->
                    <div id="guarantorSignatureSection" class="hidden">
                        <h4>Guarantor Signature</h4>
                        <div class="form-group">
                            <label for="guarantorNameConfirm">Confirm Guarantor Name</label>
                            <input type="text" id="guarantorNameConfirm" placeholder="Re-enter guarantor name">
                        </div>
                        
                        <div class="signature-container">
                            <canvas id="guarantorSignature" class="signature-canvas"></canvas>
                            <div class="signature-controls">
                                <button class="btn btn-warning" onclick="saveSignature('guarantorSignature', 'guarantorSigSaved')">Save Signature</button>
                                <button class="btn btn-secondary" onclick="clearSignature('guarantorSignature')">Clear</button>
                            </div>
                            <img id="guarantorSigSaved" class="hidden" alt="Saved signature">
                        </div>
                        <hr class="divider">
                    </div>

                    <!-- Witness Details -->
                    <h4>Witness Details</h4>
                    <div class="form-group">
                        <label for="witnessName">Witness Name</label>
                        <input type="text" id="witnessName" placeholder="Enter witness name" required>
                    </div>
                    <div class="form-group">
                        <label for="witnessEmail">Witness Email</label>
                        <input type="email" id="witnessEmail" placeholder="Enter witness email" required>
                    </div>
                    <div class="form-group">
                        <label for="witnessAddress">Witness Address</label>
                        <input type="text" id="witnessAddress" placeholder="Enter witness address" required>
                    </div>

                    <div class="signature-container">
                        <canvas id="witnessSignature" class="signature-canvas"></canvas>
                        <div class="signature-controls">
                            <button class="btn btn-warning" onclick="saveSignature('witnessSignature', 'witnessSigSaved')">Save Signature</button>
                            <button class="btn btn-secondary" onclick="clearSignature('witnessSignature')">Clear</button>
                        </div>
                        <img id="witnessSigSaved" class="hidden" alt="Saved signature">
                    </div>

                    <button class="btn btn-center btn-large" onclick="finalizeContract()">Complete Contract</button>
                </div>
            </div>

            <!-- Final Actions -->
            <div class="text-center mt-1">
                <button class="btn btn-large" onclick="printContract()" id="printBtn" style="display: none;">
                    ðŸ’¾ Save as PDF
                </button>
            </div>
        </div>

        <!-- Hidden Contract Template -->
        <div id="contractTemplate" class="hidden">
            <div class="contract-section">
                <h2>Money Lending Agreement</h2>
                
                <h3>I. ACKNOWLEDGMENT</h3>
                <p>The Lender (<span class="contract-highlight" id="contractLenderName"></span>) agrees to lend to the Borrower (<span class="contract-highlight" id="contractBorrowerName"></span>) under these terms. The Borrower acknowledges the total repayment amount including interest defined in this contract.</p>

                <h3>II. PAYMENT PLAN</h3>
                <p>The full loan amount will be transferred by the Lender to the Borrower by <span class="contract-highlight" id="contractTransferDate"></span>. Payments will be made via cash or bank transfer. If payments are made via cash it is the responsibility of the Borrower to record evidence of the payment.</p>
                <p>The first payment will be paid on <span class="contract-highlight" id="contractStartDate"></span>. The final payment will be paid on <span class="contract-highlight" id="contractEndDate"></span>. The Loan is to be repaid <span class="contract-highlight" id="contractRepaymentType"></span>. The total number of repayments is <span class="contract-highlight" id="contractNumberRepayments"></span>. The value of each repayment is $<span class="contract-highlight" id="contractRepaymentValue"></span>.</p>

                <h3>III. PROMISE TO PAY</h3>
                <p>The Borrower promises to pay the Lender $<span class="contract-highlight" id="contractLoanAmount"></span> and <span class="contract-highlight" id="contractInterestRate"></span>% interest within the established timeframe of the loan. This will result in a total transfer from the Borrower to the Lender of $<span class="contract-highlight" id="contractTotalRepayment"></span>.</p>

                <h3>IV. LATE CHARGES</h3>
                <p>Late charges of 5% will be applied for any late payments at the discretion of the Lender. 5 days after the payment due date will be considered as late.</p>

                <h3>V. SECURITY / COLLATERAL</h3>
                <p>For security and protection of the Lender, the Borrower gives the following security interest or mortgage:</p>
                <div id="contractCollateralImage"></div>
                <p><span class="contract-highlight" id="contractCollateralDescription"></span></p>
                <p>Possession of this collateral is to be transferred from the Borrower to the Lender <span class="contract-highlight" id="contractPossessionDate"></span>. Possession of the collateral is to be transferred from the Lender to the Borrower upon receiving the total payment of the loan. Ownership of the collateral is to be transferred from the Borrower to the Lender in the event of <span class="contract-highlight" id="contractMissedPayment"></span> missed payments. Upon the Lender receiving ownership and possession of the collateral the loan is considered repaid and the contract is concluded.</p>
                <p>Until the conclusion of the loan the collateral is to be kept in the following condition:</p>
                <p><span class="contract-highlight" id="contractCollateralCondition"></span></p>

                <h3>VI. DEFAULT</h3>
                <p>The following instances indicate default of this Loan Agreement, which means the remaining balance should be paid immediately otherwise the collateral becomes the property of the lender:</p>
                <p>(a) If the Borrower fails to pay in due date;<br>
                (b) Borrower's inability to pay debts;<br>
                (c) The Borrower is deceased or incompetent;<br>
                (d) The Borrower is filing for bankruptcy;</p>
                <p>In the event that the Borrower defaults on the loan <span class="contract-highlight" id="contractGuarantorName"></span><span class="contract-highlight" id="contractGuarantorStatus"></span></p>
                <p>In the event that the guarantor pays the remaining balance of the loan within the repayment date, ownership of the collateral cannot be claimed by the Lender.</p>

                <h3>VII. AMENDMENT</h3>
                <p>This loan agreement can only be changed or modified through the written consent of both parties.</p>

                <h3>VIII. GOVERNING LAW</h3>
                <p>This agreement shall be governed under the laws of the residing state and nation of the Lender.</p>

                <h3>IX. OWNERSHIP</h3>
                <p>This Loan Agreement is not transferable without written consent of both parties.</p>

                <h3>X. SIGNATURES</h3>
                <div class="signatures">
                    <div class="signature-block">
                        <p><strong>Lender:</strong></p>
                        <p id="contractLenderNameSig"></p>
                        <p id="contractLenderAddress"></p>
                        <p id="contractLenderEmail"></p>
                        <img id="contractLenderSignature" style="max-width: 200px; height: auto;">
                        <img id="contractLenderID" style="max-width: 150px; height: auto;">
                    </div>

                    <div class="signature-block">
                        <p><strong>Borrower:</strong></p>
                        <p id="contractBorrowerNameSig"></p>
                        <p id="contractBorrowerAddress"></p>
                        <p id="contractBorrowerEmail"></p>
                        <img id="contractBorrowerSignature" style="max-width: 200px; height: auto;">
                        <img id="contractBorrowerID" style="max-width: 150px; height: auto;">
                    </div>

                    <div class="signature-block" id="contractGuarantorBlock">
                        <p><strong>Guarantor:</strong></p>
                        <p id="contractGuarantorNameSig"></p>
                        <p id="contractGuarantorAddress"></p>
                        <p id="contractGuarantorEmail"></p>
                        <img id="contractGuarantorSignature" style="max-width: 200px; height: auto;">
                    </div>

                    <div class="signature-block">
                        <p><strong>Witness:</strong></p>
                        <p id="contractWitnessName"></p>
                        <p id="contractWitnessEmail"></p>
                        <p id="contractWitnessAddress"></p>
                        <img id="contractWitnessSignature" style="max-width: 200px; height: auto;">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // === GLOBAL STATE ===
        let contractData = {};
        let signatures = {};
        let currentSection = null;

        // === PROGRESS TRACKING ===
        function updateProgress() {
            const sections = ['section1', 'section2', 'section3', 'section4', 'section5', 'section6'];
            const completed = sections.filter(id => document.getElementById(id).classList.contains('completed')).length;
            const progress = (completed / sections.length) * 100;
            document.getElementById('progress').style.width = progress + '%';
        }

        // === SECTION MANAGEMENT ===
        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            const isActive = section.classList.contains('active');
            
            // Close all sections
            document.querySelectorAll('.section-panel').forEach(panel => {
                panel.classList.remove('active');
            });

            // Open clicked section if it wasn't active
            if (!isActive) {
                section.classList.add('active');
                currentSection = sectionId;
            } else {
                currentSection = null;
            }
        }

        function markSectionComplete(sectionId) {
            document.getElementById(sectionId).classList.add('completed');
            updateProgress();
        }

        // === IMAGE LOADING ===
        function loadImage(event, previewId) {
            const preview = document.getElementById(previewId);
            const file = event.target.files[0];
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        }

        // === SIGNATURE MANAGEMENT ===
        function initSignatureCanvas(canvasId) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            
            // Set canvas size
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;
            
            // Set drawing style
            ctx.fillStyle = '#fff';
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            let isDrawing = false;
            let lastX = 0;
            let lastY = 0;

            function startDrawing(e) {
                isDrawing = true;
                [lastX, lastY] = getCoordinates(e);
            }

            function draw(e) {
                if (!isDrawing) return;
                
                const [currentX, currentY] = getCoordinates(e);
                
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(currentX, currentY);
                ctx.stroke();
                
                [lastX, lastY] = [currentX, currentY];
            }

            function stopDrawing() {
                isDrawing = false;
            }

            function getCoordinates(e) {
                const rect = canvas.getBoundingClientRect();
                const clientX = e.clientX || (e.touches && e.touches[0].clientX);
                const clientY = e.clientY || (e.touches && e.touches[0].clientY);
                return [
                    clientX - rect.left,
                    clientY - rect.top
                ];
            }

            // Mouse events
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);

            // Touch events
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                startDrawing(e);
            });
            canvas.addEventListener('touchmove', (e) => {
                e.preventDefault();
                draw(e);
            });
            canvas.addEventListener('touchend', (e) => {
                e.preventDefault();
                stopDrawing();
            });
        }

        function saveSignature(canvasId, imageId) {
            const canvas = document.getElementById(canvasId);
            const dataURL = canvas.toDataURL('image/png');
            const img = document.getElementById(imageId);
            img.src = dataURL;
            img.classList.remove('hidden');
            signatures[canvasId] = dataURL;
        }

        function clearSignature(canvasId) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#fff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            const imageId = canvasId.replace('Signature', 'SigSaved');
            const img = document.getElementById(imageId);
            img.classList.add('hidden');
            delete signatures[canvasId];
        }

        // === FORM VALIDATION ===
        function validateSection(sectionNum) {
            const sectionId = `section${sectionNum}`;
            const section = document.getElementById(sectionId);
            const requiredInputs = section.querySelectorAll('input[required], select[required], textarea[required]');
            
            for (let input of requiredInputs) {
                if (!input.value.trim()) {
                    input.focus();
                    alert(`Please fill in: ${input.previousElementSibling.textContent}`);
                    return false;
                }
            }
            return true;
        }

        // === SECTION SAVE FUNCTIONS ===
        function saveSection1() {
            if (!validateSection(1)) return;
            
            contractData.lender = {
                name: document.getElementById('lenderName').value,
                address: document.getElementById('lenderAddress').value,
                email: document.getElementById('lenderEmail').value
            };
            
            contractData.borrower = {
                name: document.getElementById('borrowerName').value,
                address: document.getElementById('borrowerAddress').value,
                email: document.getElementById('borrowerEmail').value
            };
            
            markSectionComplete('section1');
            toggleSection('section2');
        }

        function saveSection2() {
            if (!validateSection(2)) return;
            
            contractData.loan = {
                amount: document.getElementById('loanAmount').value,
                interestRate: document.getElementById('interestRate').value,
                totalRepayment: document.getElementById('totalRepayment').value,
                repaymentType: document.getElementById('repaymentType').value,
                transferDate: document.getElementById('transferDate').value,
                startDate: document.getElementById('startDate').value,
                endDate: document.getElementById('endDate').value,
                numberRepayments: document.getElementById('numberRepayments').value,
                repaymentValue: document.getElementById('repaymentValue').value
            };
            
            markSectionComplete('section2');
            toggleSection('section3');
        }

        function saveSection3() {
            if (!validateSection(3)) return;
            
            contractData.collateral = {
                possessionDate: document.getElementById('possessionDate').value,
                description: document.getElementById('collateralDescription').value,
                condition: document.getElementById('collateralCondition').value,
                missedPayment: document.getElementById('missedPayment').value,
                image: document.getElementById('collateralPreview').src
            };
            
            markSectionComplete('section3');
            toggleSection('section4');
        }

        function saveSection4() {
            if (!validateSection(4)) return;
            
            const hasGuarantor = document.getElementById('hasGuarantor').value;
            contractData.guarantor = {
                hasGuarantor: hasGuarantor,
                name: document.getElementById('guarantorName').value,
                address: document.getElementById('guarantorAddress').value,
                email: document.getElementById('guarantorEmail').value
            };
            
            markSectionComplete('section4');
            toggleSection('section5');
        }

        function toggleGuarantorFields() {
            const hasGuarantor = document.getElementById('hasGuarantor').value;
            const fields = document.getElementById('guarantorFields');
            const signatureSection = document.getElementById('guarantorSignatureSection');
            
            if (hasGuarantor.includes('has agreed')) {
                fields.classList.remove('hidden');
                if (signatureSection) signatureSection.classList.remove('hidden');
            } else {
                fields.classList.add('hidden');
                if (signatureSection) signatureSection.classList.add('hidden');
            }
        }

        function nextToSignature() {
            markSectionComplete('section5');
            toggleSection('section6');
            
            // Initialize signature canvases when section opens
            setTimeout(() => {
                initSignatureCanvas('lenderSignature');
                initSignatureCanvas('borrowerSignature');
                initSignatureCanvas('guarantorSignature');
                initSignatureCanvas('witnessSignature');
            }, 100);
        }

        function generatePreview() {
            // Populate contract template with data
            const template = document.getElementById('contractTemplate').innerHTML;
            const preview = document.getElementById('contract-preview');
            
            preview.innerHTML = template;
            preview.classList.add('visible');
            
            // Fill in all the contract data
            if (contractData.lender) {
                document.getElementById('contractLenderName').textContent = contractData.lender.name;
                document.getElementById('contractLenderAddress').textContent = contractData.lender.address;
                document.getElementById('contractLenderEmail').textContent = contractData.lender.email;
            }
            
            if (contractData.borrower) {
                document.getElementById('contractBorrowerName').textContent = contractData.borrower.name;
                document.getElementById('contractBorrowerAddress').textContent = contractData.borrower.address;
                document.getElementById('contractBorrowerEmail').textContent = contractData.borrower.email;
            }
            
            if (contractData.loan) {
                document.getElementById('contractLoanAmount').textContent = contractData.loan.amount;
                document.getElementById('contractInterestRate').textContent = contractData.loan.interestRate;
                document.getElementById('contractTotalRepayment').textContent = contractData.loan.totalRepayment;
                document.getElementById('contractRepaymentType').textContent = contractData.loan.repaymentType;
                document.getElementById('contractTransferDate').textContent = contractData.loan.transferDate;
                document.getElementById('contractStartDate').textContent = contractData.loan.startDate;
                document.getElementById('contractEndDate').textContent = contractData.loan.endDate;
                document.getElementById('contractNumberRepayments').textContent = contractData.loan.numberRepayments;
                document.getElementById('contractRepaymentValue').textContent = contractData.loan.repaymentValue;
            }
            
            if (contractData.collateral) {
                document.getElementById('contractPossessionDate').textContent = contractData.collateral.possessionDate;
                document.getElementById('contractCollateralDescription').textContent = contractData.collateral.description;
                document.getElementById('contractCollateralCondition').textContent = contractData.collateral.condition;
                document.getElementById('contractMissedPayment').textContent = contractData.collateral.missedPayment;
                
                if (contractData.collateral.image && contractData.collateral.image !== window.location.href) {
                    document.getElementById('contractCollateralImage').innerHTML = 
                        `<img src="${contractData.collateral.image}" style="max-width: 100%; height: auto; margin: 1rem 0;">`;
                }
            }
            
            if (contractData.guarantor) {
                document.getElementById('contractGuarantorName').textContent = contractData.guarantor.name || '';
                document.getElementById('contractGuarantorStatus').textContent = contractData.guarantor.hasGuarantor || '';
                
                if (!contractData.guarantor.hasGuarantor.includes('has agreed')) {
                    document.getElementById('contractGuarantorBlock').style.display = 'none';
                }
            }
        }

        function finalizeContract() {
            // Save witness data
            contractData.witness = {
                name: document.getElementById('witnessName').value,
                email: document.getElementById('witnessEmail').value,
                address: document.getElementById('witnessAddress').value
            };
            
            markSectionComplete('section6');
            document.getElementById('printBtn').style.display = 'block';
            
            // Generate final contract with signatures
            generateFinalContract();
        }

        function generateFinalContract() {
            // This would populate the final contract with all signatures and data
            // Implementation similar to generatePreview but with signatures
        }

        function printContract() {
            const contractContent = document.getElementById('contract-preview').innerHTML;
            const printWindow = window.open('', '', 'height=600,width=800');
            
            printWindow.document.write(`
                <html>
                <head>
                    <title>Money Lending Agreement</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
                        .contract-highlight { background: #ffffcc; padding: 2px 4px; border-radius: 3px; }
                        .signature-block { margin: 20px 0; page-break-inside: avoid; }
                        h2, h3 { color: #333; }
                        img { max-width: 100%; height: auto; }
                    </style>
                </head>
                <body>
                    <div style="text-align: center; margin-bottom: 30px;">
                        <h1>Unify - Contracts</h1>
                        <h2>Money Lending Agreement</h2>
                    </div>
                    ${contractContent}
                </body>
                </html>
            `);
            
            printWindow.document.close();
            printWindow.print();
        }

        // === INITIALIZATION ===
        document.addEventListener('DOMContentLoaded', function() {
            updateProgress();
            
            // Auto-open first section
            toggleSection('section1');
        });
    </script>
</body>
</html>
