<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Warren Buffett's Bubble Pop Adventure</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        body {
            background: #1a1a1a;
            font-family: 'Courier New', monospace;
            overflow: hidden;
            touch-action: none;
            position: fixed;
            width: 100%;
            height: 100%;
        }

        #debugDisplay {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.9);
            color: #00ff00;
            font-family: monospace;
            font-size: 12px;
            padding: 10px;
            border-radius: 5px;
            max-width: 300px;
            z-index: 1001;
            white-space: pre-wrap;
            border: 1px solid #00ff00;
        }

        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: grid;
            grid-template-areas: 
                "topbar topbar topbar"
                "game game powerups"
                "next next powerups"
                "quotes quotes quotes";
            grid-template-rows: 60px 2fr 80px 1fr;
            grid-template-columns: 1fr 1fr 80px;
        }

        #topBar {
            grid-area: topbar;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            padding: 8px;
            border-bottom: 2px solid #34495e;
        }

        .stat-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .stat-title {
            font-size: 12px;
            color: #bdc3c7;
            margin-bottom: 2px;
        }

        .stat-value {
            font-size: 16px;
            font-weight: bold;
        }

        #booksValue { color: #3498db; }
        #yearValue { color: #f39c12; }
        #cashValue { color: #2ecc71; }

        #gameArea {
            grid-area: game;
            position: relative;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            overflow: hidden;
        }

        #gameCanvas {
            width: 100%;
            height: 100%;
            display: block;
            touch-action: none;
            cursor: crosshair;
        }

        #powerUps {
            grid-area: powerups;
            background: rgba(0, 0, 0, 0.8);
            border-left: 2px solid #34495e;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 5px;
        }

        .powerup-slot {
            width: 50px;
            height: 50px;
            background: rgba(52, 73, 94, 0.5);
            border: 2px solid #7f8c8d;
            border-radius: 8px;
            margin-bottom: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .powerup-icon {
            font-size: 20px;
            line-height: 1;
        }

        .powerup-count {
            font-size: 10px;
            color: white;
            background: rgba(243, 156, 18, 0.9);
            border-radius: 50%;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            top: -2px;
            right: -2px;
            font-weight: bold;
        }

        #nextBubbles {
            grid-area: next;
            background: rgba(0, 0, 0, 0.8);
            border-top: 2px solid #34495e;
            display: flex;
            align-items: center;
            padding: 10px;
        }

        .next-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .cannon-display {
            width: 60px;
            height: 40px;
            background: #34495e;
            border: 2px solid #fff;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
        }

        .cannon-sugar-fill {
            position: absolute;
            bottom: 0;
            width: 100%;
            background: linear-gradient(0deg, #e74c3c, #f39c12);
            transition: height 0.3s ease;
            height: 100%;
        }

        .next-bubbles-container {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .next-bubble {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: white;
            font-weight: bold;
        }

        .next-label {
            color: #bdc3c7;
            font-size: 12px;
            margin-right: 10px;
        }

        .bubbles-remaining {
            color: #f39c12;
            font-size: 14px;
            font-weight: bold;
            margin-left: auto;
            margin-right: 20px;
        }

        #quotes {
            grid-area: quotes;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.95), rgba(44, 62, 80, 0.8));
            border-top: 3px solid #f39c12;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 15px;
            overflow: hidden;
            position: relative;
        }

        #quoteText {
            color: #ecf0f1;
            font-size: 14px;
            text-align: center;
            font-style: italic;
            line-height: 1.4;
            max-width: 90%;
            animation: fadeIn 0.5s ease-in;
            z-index: 1;
            margin-bottom: 8px;
        }

        #quoteAuthor {
            color: #f39c12;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            z-index: 1;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- Debug Display -->
    <div id="debugDisplay">Starting...</div>

    <!-- Game Container -->
    <div id="gameContainer">
        <div id="topBar">
            <div class="stat-section">
                <div class="stat-title">BOOKS</div>
                <div class="stat-value" id="booksValue">üìö 5</div>
            </div>
            <div class="stat-section">
                <div class="stat-title">YEAR</div>
                <div class="stat-value" id="yearValue">1955</div>
            </div>
            <div class="stat-section">
                <div class="stat-title">$CASH</div>
                <div class="stat-value" id="cashValue">$0</div>
            </div>
        </div>

        <div id="gameArea">
            <canvas id="gameCanvas"></canvas>
        </div>

        <div id="powerUps">
            <div class="powerup-slot">
                <div class="powerup-icon">üí•</div>
                <div class="powerup-count">1</div>
            </div>
            <div class="powerup-slot">
                <div class="powerup-icon">üï∏Ô∏è</div>
                <div class="powerup-count">1</div>
            </div>
            <div class="powerup-slot">
                <div class="powerup-icon">ü•§</div>
                <div class="powerup-count">1</div>
            </div>
        </div>

        <div id="nextBubbles">
            <div class="next-section">
                <div class="cannon-display">
                    <div class="cannon-sugar-fill" id="cannonSugarFill"></div>
                </div>
                <div class="next-label">Sugar:</div>
                <div class="next-bubbles-container" id="nextBubblesContainer">
                    <div class="next-bubble" style="background: #e74c3c;">1</div>
                    <div class="next-bubble" style="background: #3498db;">2</div>
                    <div class="next-bubble" style="background: #2ecc71;">3</div>
                </div>
            </div>
            <div class="bubbles-remaining">
                Shots: <span id="bubblesRemaining">3</span>
            </div>
        </div>

        <div id="quotes">
            <div id="quoteText">
                Testing basic game functionality...
            </div>
            <div id="quoteAuthor">- Debug Mode</div>
        </div>
    </div>

    <script>
        // Simple debug function
        let debugMessages = [];
        function debugLog(message) {
            console.log(message);
            debugMessages.push(message);
            const debugEl = document.getElementById('debugDisplay');
            if (debugEl) {
                debugEl.textContent = debugMessages.slice(-15).join('\n');
            }
        }

        debugLog('Step 1: Script parsing');

        // Simple game state
        let gameState = {
            year: 1955,
            books: 5,
            cash: 0,
            sugar: 60,
            bubblesRemaining: 3,
            gameRunning: false
        };

        debugLog('Step 2: Game state created');

        // Simple BubbleGame class
        class BubbleGame {
            constructor() {
                debugLog('Step 3: BubbleGame constructor started');
                
                this.canvas = document.getElementById('gameCanvas');
                if (!this.canvas) {
                    debugLog('ERROR: Canvas not found!');
                    return;
                }
                debugLog('Step 4: Canvas found');

                this.ctx = this.canvas.getContext('2d');
                debugLog('Step 5: Context created');

                this.setupCanvas();
                debugLog('Step 6: Canvas setup complete');

                this.initGame();
                debugLog('Step 7: Game initialized');

                this.startGameLoop();
                debugLog('Step 8: Game loop started');
            }

            setupCanvas() {
                const gameArea = document.getElementById('gameArea');
                this.canvas.width = gameArea.clientWidth || 800;
                this.canvas.height = gameArea.clientHeight || 600;
                debugLog('Canvas size: ' + this.canvas.width + 'x' + this.canvas.height);
            }

            initGame() {
                this.bubbles = [];
                this.sugar = 60;
                this.maxSugar = 60;
                this.bubblesRemaining = 3;
                this.gameRunning = true;
                this.startTime = performance.now();
                
                this.colors = ['#e74c3c', '#3498db', '#2ecc71'];
                this.bubbleRadius = 16;
                
                // Create some test bubbles
                for (let i = 0; i < 20; i++) {
                    this.bubbles.push({
                        x: (i % 10) * 60 + 50,
                        y: Math.floor(i / 10) * 40 + 50,
                        color: i % 3,
                        radius: this.bubbleRadius
                    });
                }
                
                debugLog('Created ' + this.bubbles.length + ' test bubbles');
                this.updateUI();
            }

            updateUI() {
                document.getElementById('booksValue').textContent = 'üìö ' + gameState.books;
                document.getElementById('yearValue').textContent = gameState.year;
                document.getElementById('cashValue').textContent = '$' + gameState.cash;
                document.getElementById('cannonSugarFill').style.height = ((this.sugar / this.maxSugar) * 100) + '%';
                document.getElementById('bubblesRemaining').textContent = this.bubblesRemaining;
            }

            startGameLoop() {
                this.lastTime = performance.now();
                this.gameLoop();
            }

            gameLoop() {
                const now = performance.now();
                const deltaTime = (now - this.lastTime) / 1000;
                this.lastTime = now;

                this.update(deltaTime);
                this.render();
                
                requestAnimationFrame(() => this.gameLoop());
            }

            update(deltaTime) {
                if (!this.gameRunning) return;

                // Simple sugar depletion
                this.sugar -= deltaTime * 2; // Depletes faster for testing

                // Debug every 2 seconds
                if (Math.floor(now / 2000) !== Math.floor((now - 16) / 2000)) {
                    debugLog('Sugar: ' + this.sugar.toFixed(1) + ' | Bubbles: ' + this.bubbles.length);
                }

                this.updateUI();

                if (this.sugar <= 0) {
                    debugLog('Sugar depleted - level complete!');
                    this.gameRunning = false;
                }
            }

            render() {
                // Clear canvas
                this.ctx.fillStyle = '#2c3e50';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

                // Draw bubbles
                for (let bubble of this.bubbles) {
                    this.ctx.beginPath();
                    this.ctx.arc(bubble.x, bubble.y, bubble.radius, 0, Math.PI * 2);
                    this.ctx.fillStyle = this.colors[bubble.color];
                    this.ctx.fill();
                    
                    // White highlight
                    this.ctx.beginPath();
                    this.ctx.arc(bubble.x - 5, bubble.y - 5, 5, 0, Math.PI * 2);
                    this.ctx.fillStyle = 'rgba(255, 255, 255, 0.4)';
                    this.ctx.fill();
                }

                // Draw simple cannon
                this.ctx.fillStyle = '#34495e';
                this.ctx.fillRect(this.canvas.width / 2 - 10, this.canvas.height - 30, 20, 20);
            }
        }

        debugLog('Step 9: Class defined');

        // Start game function
        function startGame() {
            debugLog('Step 10: Starting game...');
            try {
                const game = new BubbleGame();
                debugLog('Step 11: Game created successfully!');
            } catch (error) {
                debugLog('ERROR in game creation: ' + error.message);
            }
        }

        debugLog('Step 12: Functions defined');

        // Try to start immediately
        setTimeout(() => {
            debugLog('Step 13: Timeout reached - starting game');
            startGame();
        }, 100);

        debugLog('Step 14: Script complete');
    </script>
</body>
</html>
