<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unify v2.0 - Goal Achievement Through Structure</title>
    
    <!-- External Libraries -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    
    <style>
        :root {
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-tertiary: #0f3460;
            --accent-primary: #e94560;
            --accent-secondary: #533483;
            --text-primary: #eee;
            --text-secondary: #aaa;
            --border-color: #333;
            --card-shadow: 0 8px 16px rgba(0,0,0,0.3);
            --card-hover-shadow: 0 12px 24px rgba(233,69,96,0.4);
            --success: #4ecca3;
            --warning: #f4a261;
            --harada-highlight: #6a4c93;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 20px;
        }
        
        .app-container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* Header */
        header {
            background: var(--bg-secondary);
            padding: 20px 30px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: var(--card-shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        header h1 {
            color: var(--accent-primary);
            font-size: 2.5em;
            text-shadow: 0 0 20px rgba(233,69,96,0.5);
        }
        
        .header-controls {
            display: flex;
            gap: 15px;
        }
        
        .icon-btn {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2em;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .icon-btn:hover {
            background: var(--accent-primary);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(233,69,96,0.4);
        }
        
        /* Toolbar Banner */
        .toolbar-banner {
            background: var(--bg-tertiary);
            padding: 15px 30px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: var(--card-shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            min-height: 60px;
        }
        
        .toolbar-left {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .toolbar-right {
            display: flex;
            gap: 10px;
        }
        
        .toolbar-btn {
            background: var(--accent-primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .toolbar-btn:hover {
            background: #d63850;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(233,69,96,0.4);
        }
        
        .toolbar-btn:disabled {
            background: #555;
            cursor: not-allowed;
            opacity: 0.5;
        }
        
        .selection-count {
            background: var(--bg-secondary);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
        }
        
        /* Sections */
        .section {
            background: var(--bg-secondary);
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: var(--card-shadow);
            overflow: hidden;
        }
        
        .section-header {
            padding: 20px 30px;
            background: var(--bg-tertiary);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s ease;
        }
        
        .section-header:hover {
            background: rgba(15,52,96,0.8);
        }
        
        .section-title {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 1.5em;
        }
        
        .section-badge {
            background: var(--accent-primary);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .section-chevron {
            transition: transform 0.3s ease;
            font-size: 1.2em;
        }
        
        .section-chevron.open {
            transform: rotate(180deg);
        }
        
        .section-content {
            padding: 30px;
            display: none;
        }
        
        .section-content.open {
            display: block;
        }
        
        /* Controls */
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .control-btn {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .control-btn:hover, .control-btn.active {
            background: var(--accent-secondary);
            border-color: var(--accent-secondary);
        }
        
        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        input[type="text"],
        textarea,
        select {
            width: 100%;
            padding: 12px;
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 1em;
            transition: border-color 0.3s ease;
        }
        
        input[type="text"]:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--accent-primary);
        }
        
        textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .btn-primary {
            background: var(--accent-primary);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary:hover {
            background: #d63850;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(233,69,96,0.4);
        }
        
        /* Star Rating */
        .star-rating {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
        }
        
        .star {
            font-size: 2em;
            color: #444;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .star.filled {
            color: #ffd700;
        }
        
        .star:hover {
            transform: scale(1.1);
        }
        
        .rating-description {
            color: var(--text-secondary);
            font-size: 0.9em;
            margin-top: 5px;
        }
        
        /* Cards */
        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .card {
            background: var(--bg-primary);
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            position: relative;
            transition: all 0.3s ease;
            box-shadow: var(--card-shadow);
        }
        
        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--card-hover-shadow);
        }
        
        .card.selected {
            border-color: var(--accent-primary);
            box-shadow: 0 0 20px rgba(233,69,96,0.6);
            transform: translateY(-8px);
        }
        
        .card.stacked {
            box-shadow: 
                var(--card-shadow),
                0 4px 8px rgba(0,0,0,0.2),
                0 8px 16px rgba(0,0,0,0.15);
        }
        
        .card.assigned {
            opacity: 0.6;
            border-color: var(--success);
        }
        
        .card.harada-task {
            background: linear-gradient(135deg, var(--bg-primary) 0%, rgba(106,76,147,0.2) 100%);
            border-color: var(--harada-highlight);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .card-checkbox {
            width: 24px;
            height: 24px;
            cursor: pointer;
            accent-color: var(--accent-primary);
        }
        
        .card-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .meta-tag {
            background: var(--bg-tertiary);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.85em;
            color: var(--text-secondary);
        }
        
        .card-description {
            font-size: 1.1em;
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        .card-description.finished {
            text-decoration: line-through;
            opacity: 0.6;
        }
        
        .card-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .card-btn {
            flex: 1;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }
        
        .card-btn:hover {
            background: var(--accent-secondary);
            border-color: var(--accent-secondary);
        }
        
        .delete-btn {
            background: transparent;
            color: var(--accent-primary);
            border: none;
            cursor: pointer;
            font-size: 1.2em;
            padding: 5px;
            transition: all 0.3s ease;
        }
        
        .delete-btn:hover {
            color: #d63850;
            transform: scale(1.2);
        }
        
        /* Problem Stack Visualization */
        .problem-stack {
            position: relative;
            margin-bottom: 15px;
            min-height: 30px;
        }
        
        .problem-card-tip {
            position: absolute;
            width: 100%;
            height: 8px;
            background: linear-gradient(90deg, var(--accent-secondary), var(--accent-primary));
            border-radius: 4px 4px 0 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .problem-card-tip:nth-child(2) {
            top: 4px;
            opacity: 0.8;
        }
        
        .problem-card-tip:nth-child(3) {
            top: 8px;
            opacity: 0.6;
        }
        
        .problem-card-tip:nth-child(4) {
            top: 12px;
            opacity: 0.4;
        }
        
        .problem-count {
            position: absolute;
            right: 0;
            top: 0;
            background: var(--accent-primary);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        /* Mode Toggle */
        .mode-toggle {
            display: flex;
            background: var(--bg-tertiary);
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .mode-btn {
            flex: 1;
            background: transparent;
            color: var(--text-secondary);
            border: none;
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
        }
        
        .mode-btn.active {
            background: var(--accent-primary);
            color: white;
        }
        
        /* Harada List */
        .harada-list {
            background: var(--bg-primary);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .harada-goal {
            font-size: 1.3em;
            color: var(--accent-primary);
            margin-bottom: 20px;
            font-weight: bold;
        }
        
        .harada-subgoal {
            margin-bottom: 25px;
        }
        
        .harada-subgoal-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .harada-subgoal-number {
            background: var(--accent-secondary);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .harada-subgoal-input {
            flex: 1;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            padding: 8px 12px;
            border-radius: 6px;
            color: var(--text-primary);
        }
        
        .harada-items {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-left: 40px;
        }
        
        .harada-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .harada-item-label {
            color: var(--text-secondary);
            font-weight: bold;
            min-width: 20px;
        }
        
        .harada-item-input {
            flex: 1;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            padding: 6px 10px;
            border-radius: 4px;
            color: var(--text-primary);
            font-size: 0.9em;
        }
        
        .harada-item-actions {
            display: flex;
            gap: 5px;
        }
        
        .harada-send-btn {
            background: var(--harada-highlight);
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
            transition: all 0.3s ease;
        }
        
        .harada-send-btn:hover {
            background: #8b6bb7;
        }
        
        .harada-send-btn.sent {
            background: var(--success);
        }
        
        /* Harada Grid */
        .harada-grid-container {
            background: var(--bg-primary);
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
        }
        
        .harada-grid {
            display: grid;
            grid-template-columns: repeat(8, 100px);
            grid-template-rows: repeat(8, 100px);
            gap: 8px;
            margin: 0 auto;
            width: fit-content;
        }
        
        .harada-cell {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 6px;
            padding: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 0.75em;
            position: relative;
            overflow: hidden;
        }
        
        .harada-cell:hover {
            border-color: var(--accent-primary);
            transform: scale(1.05);
            z-index: 10;
        }
        
        .harada-cell.center {
            background: var(--accent-primary);
            color: white;
            font-weight: bold;
            font-size: 0.85em;
        }
        
        .harada-cell.subgoal-header {
            background: var(--accent-secondary);
            color: white;
            font-weight: bold;
        }
        
        .harada-cell-input {
            width: 100%;
            height: 100%;
            background: transparent;
            border: none;
            color: var(--text-primary);
            text-align: center;
            font-size: 1em;
        }
        
        .harada-cell-input:focus {
            outline: none;
        }
        
        /* Graveyard */
        .graveyard-container {
            background: var(--bg-primary);
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .graveyard-cards {
            display: flex;
            overflow-x: auto;
            gap: 15px;
            padding: 10px 0;
        }
        
        .graveyard-card {
            min-width: 250px;
            background: var(--bg-secondary);
            border: 2px solid #444;
            border-radius: 8px;
            padding: 15px;
            opacity: 0.7;
            transition: all 0.3s ease;
        }
        
        .graveyard-card:hover {
            opacity: 1;
            border-color: var(--accent-primary);
            transform: translateY(-4px);
        }
        
        .reactivate-btn {
            background: var(--success);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: all 0.3s ease;
        }
        
        .reactivate-btn:hover {
            background: #3da882;
        }
        
        /* Dashboard */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .chart-container {
            background: var(--bg-primary);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .progress-bar-container {
            background: var(--bg-primary);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .progress-bar {
            background: var(--bg-tertiary);
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .progress-fill {
            background: linear-gradient(90deg, var(--accent-primary), var(--success));
            height: 100%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            position: relative;
        }
        
        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5em;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .modal-close:hover {
            color: var(--accent-primary);
            transform: rotate(90deg);
        }
        
        .modal h2 {
            color: var(--accent-primary);
            margin-bottom: 20px;
        }
        
        /* Help Content */
        .help-content {
            line-height: 1.8;
        }
        
        .help-content h3 {
            color: var(--accent-primary);
            margin-top: 20px;
            margin-bottom: 10px;
        }
        
        .help-content ol, .help-content ul {
            margin-left: 20px;
            margin-bottom: 15px;
        }
        
        .help-content li {
            margin-bottom: 10px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8em;
            }
            
            .cards-container {
                grid-template-columns: 1fr;
            }
            
            .toolbar-banner {
                flex-direction: column;
                gap: 15px;
            }
            
            .harada-grid {
                grid-template-columns: repeat(8, 80px);
                grid-template-rows: repeat(8, 80px);
            }
            
            .harada-items {
                grid-template-columns: 1fr;
            }
        }
        
        /* Animations */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes stackCard {
            from {
                transform: scale(1) translateY(0);
            }
            to {
                transform: scale(0.95) translateY(-10px);
            }
        }
        
        .card.selecting {
            animation: stackCard 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header>
            <h1><i class="fas fa-layer-group"></i> Unify v2.0</h1>
            <div class="header-controls">
                <button class="icon-btn" onclick="toggleHelp()" title="Help">
                    <i class="fas fa-question"></i>
                </button>
            </div>
        </header>
        
        <!-- Toolbar Banner -->
        <div class="toolbar-banner">
            <div class="toolbar-left">
                <button class="toolbar-btn" id="selectModeBtn" onclick="toggleSelectMode()">
                    <i class="fas fa-hand-pointer"></i>
                    <span id="selectModeText">Select Problems</span>
                </button>
                <div class="selection-count" id="selectionCount" style="display: none;">
                    <i class="fas fa-layer-group"></i> <span id="selectedCount">0</span> selected
                </div>
            </div>
            <div class="toolbar-right">
                <button class="toolbar-btn" id="combineBtn" onclick="combineProblems()" disabled>
                    <i class="fas fa-plus-circle"></i> Create Goal from Selected
                </button>
            </div>
        </div>
        
        <!-- Input Problem Section -->
        <div class="section">
            <div class="section-header" onclick="toggleSection('inputProblem')">
                <div class="section-title">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>Identify Problem</span>
                </div>
                <i class="fas fa-chevron-down section-chevron" id="inputProblemChevron"></i>
            </div>
            <div class="section-content open" id="inputProblemContent">
                <div class="form-group">
                    <label for="problemArea">Problem Area</label>
                    <select id="problemArea">
                        <option value="">Select area...</option>
                        <option value="Diet">Diet</option>
                        <option value="Family">Family</option>
                        <option value="Fitness">Fitness</option>
                        <option value="Health">Health</option>
                        <option value="Home">Home</option>
                        <option value="Parenting">Parenting</option>
                        <option value="Personal">Personal</option>
                        <option value="Relationship">Relationship</option>
                        <option value="Sleep">Sleep</option>
                        <option value="Social Life">Social Life</option>
                        <option value="Study">Study</option>
                        <option value="Work">Work</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="problemEmotion">Emotion This Problem Causes</label>
                    <select id="problemEmotion">
                        <option value="">Select emotion...</option>
                        <option value="Annoyed">Annoyed</option>
                        <option value="Anxious">Anxious</option>
                        <option value="Bored">Bored</option>
                        <option value="Depressed">Depressed</option>
                        <option value="Distracted">Distracted</option>
                        <option value="Disapproving">Disapproving</option>
                        <option value="Disassociated">Disassociated</option>
                        <option value="Embarrassed">Embarrassed</option>
                        <option value="Envy">Envy</option>
                        <option value="Guilty">Guilty</option>
                        <option value="Impatient">Impatient</option>
                        <option value="Insecure">Insecure</option>
                        <option value="Let Down">Let Down</option>
                        <option value="Lonely">Lonely</option>
                        <option value="Offended">Offended</option>
                        <option value="Physical Pain">Physical Pain</option>
                        <option value="Stressed">Stressed</option>
                        <option value="Tired">Tired</option>
                        <option value="Vulnerable">Vulnerable</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="problemDescription">Problem Description</label>
                    <textarea id="problemDescription" placeholder="Describe what's bothering you..."></textarea>
                </div>
                
                <div class="form-group">
                    <label>Difficulty to Fix</label>
                    <div class="star-rating" id="problemRating">
                        <i class="fas fa-star star" data-rating="1"></i>
                        <i class="fas fa-star star" data-rating="2"></i>
                        <i class="fas fa-star star" data-rating="3"></i>
                        <i class="fas fa-star star" data-rating="4"></i>
                        <i class="fas fa-star star" data-rating="5"></i>
                    </div>
                    <div class="rating-description" id="problemRatingDesc"></div>
                </div>
                
                <button class="btn-primary" onclick="addProblem()">
                    <i class="fas fa-plus"></i> Add Problem
                </button>
            </div>
        </div>
        
        <!-- Problems List Section -->
        <div class="section">
            <div class="section-header" onclick="toggleSection('problems')">
                <div class="section-title">
                    <i class="fas fa-list"></i>
                    <span>Problems</span>
                    <span class="section-badge" id="problemsCount">0</span>
                </div>
                <i class="fas fa-chevron-down section-chevron" id="problemsChevron"></i>
            </div>
            <div class="section-content" id="problemsContent">
                <div class="controls">
                    <button class="control-btn" onclick="sortProblems('recent')">
                        <i class="fas fa-clock"></i> Recent
                    </button>
                    <button class="control-btn" onclick="sortProblems('area')">
                        <i class="fas fa-th"></i> Area
                    </button>
                    <button class="control-btn" onclick="sortProblems('emotion')">
                        <i class="fas fa-heart"></i> Emotion
                    </button>
                    <button class="control-btn" onclick="sortProblems('difficulty')">
                        <i class="fas fa-star"></i> Difficulty
                    </button>
                    <button class="control-btn" onclick="toggleFinishedProblems()">
                        <i class="fas fa-eye"></i> <span id="showHideProblems">Hide</span> Finished
                    </button>
                </div>
                <div class="cards-container" id="problemsList"></div>
            </div>
        </div>
        
        <!-- Goals List Section -->
        <div class="section">
            <div class="section-header" onclick="toggleSection('goals')">
                <div class="section-title">
                    <i class="fas fa-bullseye"></i>
                    <span>Goals</span>
                    <span class="section-badge" id="goalsCount">0</span>
                </div>
                <i class="fas fa-chevron-down section-chevron" id="goalsChevron"></i>
            </div>
            <div class="section-content" id="goalsContent">
                <div class="controls">
                    <button class="control-btn" onclick="sortGoals('recent')">
                        <i class="fas fa-clock"></i> Recent
                    </button>
                    <button class="control-btn" onclick="sortGoals('area')">
                        <i class="fas fa-th"></i> Area
                    </button>
                    <button class="control-btn" onclick="sortGoals('emotion')">
                        <i class="fas fa-heart"></i> Emotion
                    </button>
                    <button class="control-btn" onclick="sortGoals('difficulty')">
                        <i class="fas fa-star"></i> Difficulty
                    </button>
                    <button class="control-btn" onclick="toggleFinishedGoals()">
                        <i class="fas fa-eye"></i> <span id="showHideGoals">Hide</span> Finished
                    </button>
                </div>
                <div class="cards-container" id="goalsList"></div>
            </div>
        </div>
        
        <!-- Tasks List Section -->
        <div class="section">
            <div class="section-header" onclick="toggleSection('tasks')">
                <div class="section-title">
                    <i class="fas fa-tasks"></i>
                    <span>Tasks</span>
                    <span class="section-badge" id="tasksCount">0</span>
                </div>
                <i class="fas fa-chevron-down section-chevron" id="tasksChevron"></i>
            </div>
            <div class="section-content" id="tasksContent">
                <div class="controls">
                    <button class="control-btn" onclick="sortTasks('recent')">
                        <i class="fas fa-clock"></i> Recent
                    </button>
                    <button class="control-btn" onclick="sortTasks('goal')">
                        <i class="fas fa-bullseye"></i> Goal
                    </button>
                    <button class="control-btn" onclick="sortTasks('area')">
                        <i class="fas fa-th"></i> Area
                    </button>
                    <button class="control-btn" onclick="toggleFinishedTasks()">
                        <i class="fas fa-eye"></i> <span id="showHideTasks">Hide</span> Completed
                    </button>
                </div>
                <div class="cards-container" id="tasksList"></div>
            </div>
        </div>
        
        <!-- Graveyard Section -->
        <div class="section">
            <div class="section-header" onclick="toggleSection('graveyard')">
                <div class="section-title">
                    <i class="fas fa-archive"></i>
                    <span>Finished Cards</span>
                    <span class="section-badge" id="graveyardCount">0</span>
                </div>
                <i class="fas fa-chevron-down section-chevron" id="graveyardChevron"></i>
            </div>
            <div class="section-content" id="graveyardContent">
                <div class="graveyard-container">
                    <h3 style="margin-bottom: 15px;">Problems</h3>
                    <div class="graveyard-cards" id="graveyardProblems"></div>
                    
                    <h3 style="margin-top: 30px; margin-bottom: 15px;">Goals</h3>
                    <div class="graveyard-cards" id="graveyardGoals"></div>
                    
                    <h3 style="margin-top: 30px; margin-bottom: 15px;">Tasks</h3>
                    <div class="graveyard-cards" id="graveyardTasks"></div>
                </div>
            </div>
        </div>
        
        <!-- Dashboard Section -->
        <div class="section">
            <div class="section-header" onclick="toggleSection('dashboard')">
                <div class="section-title">
                    <i class="fas fa-chart-pie"></i>
                    <span>Dashboard & Insights</span>
                </div>
                <i class="fas fa-chevron-down section-chevron" id="dashboardChevron"></i>
            </div>
            <div class="section-content" id="dashboardContent">
                <div class="progress-bar-container">
                    <h3>Overall Task Completion</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%">0%</div>
                    </div>
                </div>
                
                <div class="dashboard-grid">
                    <div class="chart-container">
                        <canvas id="problemsAreaChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <canvas id="problemsEmotionChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <canvas id="goalsAreaChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <canvas id="goalsEmotionChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Goal Creation Modal -->
    <div class="modal-overlay" id="goalModal">
        <div class="modal">
            <button class="modal-close" onclick="closeGoalModal()">
                <i class="fas fa-times"></i>
            </button>
            <h2><i class="fas fa-bullseye"></i> Create Goal</h2>
            
            <div id="selectedProblemsPreview" style="margin-bottom: 20px;"></div>
            
            <div class="form-group">
                <label for="goalDescription">Goal Description</label>
                <textarea id="goalDescription" placeholder="What do you want to achieve?"></textarea>
            </div>
            
            <div class="form-group">
                <label for="goalEmotion">How does this goal make you feel?</label>
                <select id="goalEmotion">
                    <option value="Meaningful">Meaningful</option>
                    <option value="Neutral">Neutral</option>
                    <option value="Difficult">Difficult</option>
                </select>
                <div id="difficultWarning" style="display: none; color: var(--warning); margin-top: 10px;">
                    ⚠️ Consider choosing easier goals to build momentum and confidence!
                </div>
            </div>
            
            <div class="form-group">
                <label>Difficulty to Achieve</label>
                <div class="star-rating" id="goalRating">
                    <i class="fas fa-star star" data-rating="1"></i>
                    <i class="fas fa-star star" data-rating="2"></i>
                    <i class="fas fa-star star" data-rating="3"></i>
                    <i class="fas fa-star star" data-rating="4"></i>
                    <i class="fas fa-star star" data-rating="5"></i>
                </div>
                <div class="rating-description" id="goalRatingDesc"></div>
            </div>
            
            <button class="btn-primary" onclick="createGoal()">
                <i class="fas fa-plus"></i> Create Goal
            </button>
        </div>
    </div>
    
    <!-- Help Modal -->
    <div class="modal-overlay" id="helpModal">
        <div class="modal">
            <button class="modal-close" onclick="toggleHelp()">
                <i class="fas fa-times"></i>
            </button>
            <h2><i class="fas fa-info-circle"></i> How Unify Works</h2>
            
            <div class="help-content">
                <h3>The Card-Based Transformation System</h3>
                <p>Unify helps you transform negative emotions into positive achievement through a structured card-game approach:</p>
                
                <h3>1. Identify Problems (Problem Cards)</h3>
                <ul>
                    <li>Name what's bothering you and causing negative emotions</li>
                    <li>Categorize by life area and emotion</li>
                    <li>Rate the difficulty of fixing it (1-5 stars)</li>
                </ul>
                
                <h3>2. Combine into Goals (Goal Cards)</h3>
                <ul>
                    <li>Enter "Select Mode" to pick problem cards</li>
                    <li>Select one or more related problems</li>
                    <li>Click "Create Goal from Selected" to stack them together</li>
                    <li>Define a goal that addresses all selected problems</li>
                    <li>Your problems are now "under" the goal card</li>
                </ul>
                
                <h3>3. Break Down with Tasks or Harada Method</h3>
                <ul>
                    <li><strong>Task Mode:</strong> Add simple action items to your task list</li>
                    <li><strong>Harada Mode:</strong> Use the powerful 8×8 grid method for comprehensive planning</li>
                    <li>Toggle between modes as needed - both data sets persist</li>
                </ul>
                
                <h3>4. The Harada Method</h3>
                <p>The Harada Method breaks your goal into 8 subgoals, each with 8 action items (64 total steps):</p>
                <ul>
                    <li>Edit in List view or Grid view - they sync automatically</li>
                    <li>Send individual items to your task list when ready</li>
                    <li>Items stay on the grid for reference and can be updated</li>
                    <li>Perfect for ambitious, complex goals</li>
                </ul>
                
                <h3>5. Complete and Archive</h3>
                <ul>
                    <li>Check off tasks as you complete them</li>
                    <li>Mark goals as finished when achieved</li>
                    <li>Finished cards move to the "Graveyard"</li>
                    <li>Reactivate any card from the graveyard anytime</li>
                </ul>
                
                <h3>Key Features</h3>
                <ul>
                    <li><strong>Card Stacking:</strong> Multiple problems combine into single goals</li>
                    <li><strong>Visual Organization:</strong> See problem cards under each goal</li>
                    <li><strong>Dual Planning:</strong> Simple tasks OR deep Harada planning</li>
                    <li><strong>Flexible Workflow:</strong> Sort, filter, and organize your way</li>
                    <li><strong>Progress Tracking:</strong> Dashboard shows your patterns and completion</li>
                </ul>
                
                <p style="margin-top: 20px; color: var(--accent-primary);">
                    <strong>Remember:</strong> The goal is to transform negative emotions into positive action. 
                    Start small, build momentum, and watch your problems transform into achievements!
                </p>
            </div>
        </div>
    </div>
    
    <script>
        // Global State
        let problems = [];
        let goals = [];
        let tasks = [];
        let graveyard = {
            problems: [],
            goals: [],
            tasks: []
        };
        
        let selectMode = false;
        let selectedProblemIds = [];
        let currentProblemRating = 0;
        let currentGoalRating = 0;
        
        let showFinishedProblems = false;
        let showFinishedGoals = false;
        let showFinishedTasks = false;
        
        let problemSortCriteria = 'recent';
        let goalSortCriteria = 'recent';
        let taskSortCriteria = 'recent';
        
        // Chart instances
        let charts = {};
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            initStarRatings();
            initGoalEmotionListener();
            renderAll();
            updateStats();
        });
        
        // Load data from localStorage
        function loadData() {
            const saved = localStorage.getItem('unifyV2Data');
            if (saved) {
                const data = JSON.parse(saved);
                problems = data.problems || [];
                goals = data.goals || [];
                tasks = data.tasks || [];
                graveyard = data.graveyard || { problems: [], goals: [], tasks: [] };
            } else {
                // Add sample data
                addSampleData();
            }
        }
        
        // Save data to localStorage
        function saveData() {
            localStorage.setItem('unifyV2Data', JSON.stringify({
                problems,
                goals,
                tasks,
                graveyard
            }));
        }
        
        // Add sample data
        function addSampleData() {
            const sampleProblem = {
                id: 'p' + Date.now(),
                area: 'Personal',
                emotion: 'Anxious',
                description: 'Not sure how to get started with Unify',
                difficulty: 1,
                finished: false,
                assigned: false,
                goalId: null,
                timestamp: Date.now()
            };
            problems.push(sampleProblem);
            
            showToast('Welcome!', 'Sample problem added to get you started', 'info');
            saveData();
        }
        
        // Toggle section
        function toggleSection(sectionId) {
            const content = document.getElementById(sectionId + 'Content');
            const chevron = document.getElementById(sectionId + 'Chevron');
            
            content.classList.toggle('open');
            chevron.classList.toggle('open');
        }
        
        // Toggle select mode
        function toggleSelectMode() {
            selectMode = !selectMode;
            const btn = document.getElementById('selectModeBtn');
            const text = document.getElementById('selectModeText');
            const countEl = document.getElementById('selectionCount');
            
            if (selectMode) {
                btn.style.background = 'var(--accent-secondary)';
                text.textContent = 'Exit Select Mode';
                countEl.style.display = 'block';
            } else {
                btn.style.background = '';
                text.textContent = 'Select Problems';
                countEl.style.display = 'none';
                selectedProblemIds = [];
                updateSelectionCount();
            }
            
            renderProblems();
        }
        
        // Update selection count
        function updateSelectionCount() {
            document.getElementById('selectedCount').textContent = selectedProblemIds.length;
            document.getElementById('combineBtn').disabled = selectedProblemIds.length === 0;
        }
        
        // Toggle problem selection
        function toggleProblemSelection(problemId) {
            if (!selectMode) return;
            
            const index = selectedProblemIds.indexOf(problemId);
            if (index > -1) {
                selectedProblemIds.splice(index, 1);
            } else {
                selectedProblemIds.push(problemId);
            }
            
            updateSelectionCount();
            renderProblems();
        }
        
        // Combine problems into goal
        function combineProblems() {
            if (selectedProblemIds.length === 0) return;
            
            // Show goal creation modal
            const preview = document.getElementById('selectedProblemsPreview');
            preview.innerHTML = '<h4>Selected Problems:</h4>';
            
            selectedProblemIds.forEach(id => {
                const problem = problems.find(p => p.id === id);
                if (problem) {
                    preview.innerHTML += `<div class="meta-tag">${problem.area} - ${problem.emotion}</div>`;
                }
            });
            
            document.getElementById('goalModal').classList.add('active');
        }
        
        // Close goal modal
        function closeGoalModal() {
            document.getElementById('goalModal').classList.remove('active');
            document.getElementById('goalDescription').value = '';
            document.getElementById('goalEmotion').value = 'Meaningful';
            currentGoalRating = 0;
            updateGoalStars();
        }
        
        // Create goal
        function createGoal() {
            const description = document.getElementById('goalDescription').value.trim();
            const emotion = document.getElementById('goalEmotion').value;
            
            if (!description) {
                showToast('Error', 'Please enter a goal description', 'error');
                return;
            }
            
            if (currentGoalRating === 0) {
                showToast('Error', 'Please rate the difficulty', 'error');
                return;
            }
            
            // Get areas from selected problems
            const selectedProblems = problems.filter(p => selectedProblemIds.includes(p.id));
            const areas = [...new Set(selectedProblems.map(p => p.area))];
            
            const goal = {
                id: 'g' + Date.now(),
                description: description,
                area: areas.join(', '),
                emotion: emotion,
                difficulty: currentGoalRating,
                problemIds: [...selectedProblemIds],
                finished: false,
                timestamp: Date.now(),
                mode: 'task', // task or harada
                haradaData: initializeHaradaData(description),
                simpleTasks: []
            };
            
            goals.push(goal);
            
            // Mark problems as assigned
            selectedProblemIds.forEach(id => {
                const problem = problems.find(p => p.id === id);
                if (problem) {
                    problem.assigned = true;
                    problem.goalId = goal.id;
                }
            });
            
            showToast('Success!', 'Goal created from ' + selectedProblemIds.length + ' problem(s)', 'success');
            
            saveData();
            closeGoalModal();
            
            // Exit select mode and clear selection
            if (selectMode) {
                toggleSelectMode();
            }
            selectedProblemIds = [];
            
            renderAll();
            updateStats();
        }
        
        // Initialize Harada data structure
        function initializeHaradaData(goalDescription) {
            const data = {
                centerGoal: goalDescription,
                subgoals: []
            };
            
            for (let i = 1; i <= 8; i++) {
                data.subgoals.push({
                    number: i,
                    name: 'Subgoal ' + i,
                    items: Array(8).fill('').map((_, idx) => ({
                        label: String.fromCharCode(65 + idx), // A-H
                        text: '',
                        sent: false
                    }))
                });
            }
            
            return data;
        }
        
        // Add problem
        function addProblem() {
            const area = document.getElementById('problemArea').value;
            const emotion = document.getElementById('problemEmotion').value;
            const description = document.getElementById('problemDescription').value.trim();
            
            if (!area || !emotion || !description) {
                showToast('Error', 'Please fill in all fields', 'error');
                return;
            }
            
            if (currentProblemRating === 0) {
                showToast('Error', 'Please rate the difficulty', 'error');
                return;
            }
            
            const problem = {
                id: 'p' + Date.now(),
                area: area,
                emotion: emotion,
                description: description,
                difficulty: currentProblemRating,
                finished: false,
                assigned: false,
                goalId: null,
                timestamp: Date.now()
            };
            
            problems.push(problem);
            
            // Clear form
            document.getElementById('problemArea').value = '';
            document.getElementById('problemEmotion').value = '';
            document.getElementById('problemDescription').value = '';
            currentProblemRating = 0;
            updateProblemStars();
            
            showToast('Success!', 'Problem added', 'success');
            
            saveData();
            renderProblems();
            updateStats();
            updateCounts();
        }
        
        // Toggle problem finished
        function toggleProblemFinished(id) {
            const problem = problems.find(p => p.id === id);
            if (!problem) return;
            
            problem.finished = !problem.finished;
            
            if (problem.finished) {
                showToast('Complete!', 'Problem marked as finished', 'success');
            }
            
            saveData();
            renderProblems();
            updateStats();
            updateCounts();
        }
        
        // Delete problem
        function deleteProblem(id) {
            const index = problems.findIndex(p => p.id === id);
            if (index > -1) {
                const problem = problems.splice(index, 1)[0];
                graveyard.problems.push(problem);
                
                showToast('Archived', 'Problem moved to graveyard', 'info');
                
                saveData();
                renderProblems();
                renderGraveyard();
                updateStats();
                updateCounts();
            }
        }
        
        // Render problems
        function renderProblems() {
            const container = document.getElementById('problemsList');
            const sortedProblems = sortArray(problems, problemSortCriteria);
            
            let filteredProblems = sortedProblems;
            if (!showFinishedProblems) {
                filteredProblems = sortedProblems.filter(p => !p.finished);
            }
            
            if (filteredProblems.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 40px;">No problems to display. Add a new problem above!</p>';
                return;
            }
            
            container.innerHTML = filteredProblems.map(problem => {
                const isSelected = selectedProblemIds.includes(problem.id);
                const cardClass = `card ${isSelected ? 'selected' : ''} ${problem.assigned ? 'assigned' : ''}`;
                
                return `
                    <div class="${cardClass}" ${selectMode ? `onclick="toggleProblemSelection('${problem.id}')"` : ''}>
                        ${selectMode ? `
                            <div class="card-header">
                                <input type="checkbox" class="card-checkbox" 
                                    ${isSelected ? 'checked' : ''} 
                                    onclick="event.stopPropagation(); toggleProblemSelection('${problem.id}')">
                            </div>
                        ` : ''}
                        
                        <div class="card-meta">
                            <span class="meta-tag"><i class="fas fa-th"></i> ${problem.area}</span>
                            <span class="meta-tag"><i class="fas fa-heart"></i> ${problem.emotion}</span>
                            <span class="meta-tag"><i class="fas fa-star"></i> ${problem.difficulty}/5</span>
                            ${problem.assigned ? '<span class="meta-tag" style="background: var(--success);">Assigned to Goal</span>' : ''}
                        </div>
                        
                        <div class="card-description ${problem.finished ? 'finished' : ''}">
                            ${problem.description}
                        </div>
                        
                        ${!selectMode ? `
                            <div class="card-actions">
                                <button class="card-btn" onclick="event.stopPropagation(); toggleProblemFinished('${problem.id}')">
                                    <i class="fas fa-${problem.finished ? 'undo' : 'check'}"></i>
                                    ${problem.finished ? 'Unfinish' : 'Mark Finished'}
                                </button>
                                ${problem.finished ? `
                                    <button class="delete-btn" onclick="event.stopPropagation(); deleteProblem('${problem.id}')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                ` : ''}
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }
        
        // Toggle goal mode
        function toggleGoalMode(goalId, mode) {
            const goal = goals.find(g => g.id === goalId);
            if (!goal) return;
            
            goal.mode = mode;
            saveData();
            renderGoals();
        }
        
        // Add simple task from goal
        function addSimpleTask(goalId) {
            const input = document.getElementById('simpleTask_' + goalId);
            if (!input) return;
            
            const taskText = input.value.trim();
            if (!taskText) {
                showToast('Error', 'Please enter a task', 'error');
                return;
            }
            
            const goal = goals.find(g => g.id === goalId);
            if (!goal) return;
            
            const task = {
                id: 't' + Date.now(),
                description: taskText,
                goalId: goal.id,
                goalDescription: goal.description,
                area: goal.area,
                notes: '',
                completed: false,
                haradaSource: null,
                timestamp: Date.now()
            };
            
            tasks.push(task);
            input.value = '';
            
            showToast('Success!', 'Task added', 'success');
            
            saveData();
            renderTasks();
            updateStats();
            updateCounts();
        }
        
        // Update Harada subgoal name
        function updateHaradaSubgoal(goalId, subgoalIndex, value) {
            const goal = goals.find(g => g.id === goalId);
            if (!goal) return;
            
            goal.haradaData.subgoals[subgoalIndex].name = value;
            saveData();
        }
        
        // Update Harada item
        function updateHaradaItem(goalId, subgoalIndex, itemIndex, value) {
            const goal = goals.find(g => g.id === goalId);
            if (!goal) return;
            
            goal.haradaData.subgoals[subgoalIndex].items[itemIndex].text = value;
            saveData();
        }
        
        // Send Harada item to tasks
        function sendHaradaToTasks(goalId, subgoalIndex, itemIndex) {
            const goal = goals.find(g => g.id === goalId);
            if (!goal) return;
            
            const subgoal = goal.haradaData.subgoals[subgoalIndex];
            const item = subgoal.items[itemIndex];
            
            if (!item.text.trim()) {
                showToast('Error', 'Item is empty', 'error');
                return;
            }
            
            const task = {
                id: 't' + Date.now(),
                description: item.text,
                goalId: goal.id,
                goalDescription: goal.description,
                area: goal.area,
                notes: '',
                completed: false,
                haradaSource: {
                    subgoalNumber: subgoal.number,
                    subgoalName: subgoal.name,
                    itemLabel: item.label
                },
                timestamp: Date.now()
            };
            
            tasks.push(task);
            item.sent = true;
            
            showToast('Success!', 'Harada item sent to tasks', 'success');
            
            saveData();
            renderGoals();
            renderTasks();
            updateStats();
            updateCounts();
        }
        
        // Update Harada grid cell
        function updateHaradaGrid(goalId, row, col, value) {
            const goal = goals.find(g => g.id === goalId);
            if (!goal) return;
            
            // Center cell
            if (row === 3 && col === 3) {
                goal.haradaData.centerGoal = value;
                saveData();
                return;
            }
            
            // Determine which subgoal this belongs to
            const subgoalMap = [
                [0, 0, 0, 1, 1, 1, 2, 2, 2],
                [0, 0, 0, 1, 1, 1, 2, 2, 2],
                [0, 0, 0, 1, 1, 1, 2, 2, 2],
                [7, 7, 7, -1, -1, -1, 3, 3, 3],
                [7, 7, 7, -1, -1, -1, 3, 3, 3],
                [7, 7, 7, -1, -1, -1, 3, 3, 3],
                [6, 6, 6, 5, 5, 5, 4, 4, 4],
                [6, 6, 6, 5, 5, 5, 4, 4, 4],
                [6, 6, 6, 5, 5, 5, 4, 4, 4]
            ];
            
            const subgoalIndex = subgoalMap[row][col];
            if (subgoalIndex === -1) return; // Center area
            
            // Determine local position within 3x3 grid
            const localRow = row % 3;
            const localCol = col % 3;
            
            // First row is header (subgoal name)
            if (localRow === 0 && localCol === 1) {
                goal.haradaData.subgoals[subgoalIndex].name = value;
            } else if (localRow > 0) {
                // Calculate item index (A-H)
                const itemIndex = (localRow - 1) * 3 + localCol;
                if (itemIndex < 8) {
                    goal.haradaData.subgoals[subgoalIndex].items[itemIndex].text = value;
                }
            }
            
            saveData();
        }
        
        // Toggle goal finished
        function toggleGoalFinished(id) {
            const goal = goals.find(g => g.id === id);
            if (!goal) return;
            
            goal.finished = !goal.finished;
            
            if (goal.finished) {
                // Also finish associated problems
                goal.problemIds.forEach(problemId => {
                    const problem = problems.find(p => p.id === problemId);
                    if (problem) {
                        problem.finished = true;
                    }
                });
                
                showToast('Complete!', 'Goal and associated problems marked as finished', 'success');
            }
            
            saveData();
            renderGoals();
            renderProblems();
            updateStats();
            updateCounts();
        }
        
        // Delete goal
        function deleteGoal(id) {
            const index = goals.findIndex(g => g.id === id);
            if (index > -1) {
                const goal = goals.splice(index, 1)[0];
                graveyard.goals.push(goal);
                
                // Unassign problems
                goal.problemIds.forEach(problemId => {
                    const problem = problems.find(p => p.id === problemId);
                    if (problem) {
                        problem.assigned = false;
                        problem.goalId = null;
                        graveyard.problems.push(problem);
                    }
                });
                
                // Move related problems to graveyard
                goal.problemIds.forEach(problemId => {
                    const pIndex = problems.findIndex(p => p.id === problemId);
                    if (pIndex > -1) {
                        problems.splice(pIndex, 1);
                    }
                });
                
                showToast('Archived', 'Goal and associated problems moved to graveyard', 'info');
                
                saveData();
                renderGoals();
                renderProblems();
                renderGraveyard();
                updateStats();
                updateCounts();
            }
        }
        
        // Render goals
        function renderGoals() {
            const container = document.getElementById('goalsList');
            const sortedGoals = sortArray(goals, goalSortCriteria);
            
            let filteredGoals = sortedGoals;
            if (!showFinishedGoals) {
                filteredGoals = sortedGoals.filter(g => !g.finished);
            }
            
            if (filteredGoals.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 40px;">No goals yet. Select problems and combine them into a goal!</p>';
                return;
            }
            
            container.innerHTML = filteredGoals.map(goal => {
                const relatedProblems = problems.filter(p => goal.problemIds.includes(p.id));
                
                return `
                    <div class="card stacked">
                        <!-- Problem Stack Visualization -->
                        <div class="problem-stack">
                            ${relatedProblems.slice(0, 4).map((_, i) => `
                                <div class="problem-card-tip" style="top: ${i * 4}px; opacity: ${1 - i * 0.2}"></div>
                            `).join('')}
                            <div class="problem-count">${relatedProblems.length} problem${relatedProblems.length !== 1 ? 's' : ''}</div>
                        </div>
                        
                        <div class="card-meta">
                            <span class="meta-tag"><i class="fas fa-th"></i> ${goal.area}</span>
                            <span class="meta-tag"><i class="fas fa-heart"></i> ${goal.emotion}</span>
                            <span class="meta-tag"><i class="fas fa-star"></i> ${goal.difficulty}/5</span>
                        </div>
                        
                        <div class="card-description ${goal.finished ? 'finished' : ''}">
                            ${goal.description}
                        </div>
                        
                        ${!goal.finished ? `
                            <!-- Mode Toggle -->
                            <div class="mode-toggle">
                                <button class="mode-btn ${goal.mode === 'task' ? 'active' : ''}" 
                                    onclick="toggleGoalMode('${goal.id}', 'task')">
                                    <i class="fas fa-tasks"></i> Task Mode
                                </button>
                                <button class="mode-btn ${goal.mode === 'harada' ? 'active' : ''}"
                                    onclick="toggleGoalMode('${goal.id}', 'harada')">
                                    <i class="fas fa-th"></i> Harada Mode
                                </button>
                            </div>
                            
                            ${goal.mode === 'task' ? renderTaskMode(goal) : renderHaradaMode(goal)}
                        ` : ''}
                        
                        <div class="card-actions">
                            <button class="card-btn" onclick="toggleGoalFinished('${goal.id}')">
                                <i class="fas fa-${goal.finished ? 'undo' : 'check'}"></i>
                                ${goal.finished ? 'Unfinish' : 'Mark Finished'}
                            </button>
                            ${goal.finished ? `
                                <button class="delete-btn" onclick="deleteGoal('${goal.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Render task mode for goal
        function renderTaskMode(goal) {
            return `
                <div style="margin-top: 20px;">
                    <div class="form-group">
                        <input type="text" id="simpleTask_${goal.id}" 
                            placeholder="Enter a task and press Add..."
                            style="margin-bottom: 10px;">
                        <button class="btn-primary" onclick="addSimpleTask('${goal.id}')">
                            <i class="fas fa-plus"></i> Add Task
                        </button>
                    </div>
                </div>
            `;
        }
        
        // Render Harada mode for goal
        function renderHaradaMode(goal) {
            return `
                <div style="margin-top: 20px;">
                    <div class="mode-toggle" style="margin-bottom: 15px;">
                        <button class="mode-btn active" onclick="showHaradaList('${goal.id}')">
                            <i class="fas fa-list"></i> List View
                        </button>
                        <button class="mode-btn" onclick="showHaradaGrid('${goal.id}')">
                            <i class="fas fa-th"></i> Grid View
                        </button>
                    </div>
                    
                    <div id="haradaList_${goal.id}" class="harada-list">
                        <div class="harada-goal">Goal: ${goal.haradaData.centerGoal}</div>
                        ${goal.haradaData.subgoals.map((subgoal, sIndex) => `
                            <div class="harada-subgoal">
                                <div class="harada-subgoal-header">
                                    <div class="harada-subgoal-number">${subgoal.number}</div>
                                    <input type="text" class="harada-subgoal-input" 
                                        value="${subgoal.name}"
                                        onchange="updateHaradaSubgoal('${goal.id}', ${sIndex}, this.value)"
                                        placeholder="Subgoal ${subgoal.number}">
                                </div>
                                <div class="harada-items">
                                    ${subgoal.items.map((item, iIndex) => `
                                        <div class="harada-item">
                                            <span class="harada-item-label">${item.label}:</span>
                                            <input type="text" class="harada-item-input"
                                                value="${item.text}"
                                                onchange="updateHaradaItem('${goal.id}', ${sIndex}, ${iIndex}, this.value)"
                                                placeholder="Action item...">
                                            <div class="harada-item-actions">
                                                <button class="harada-send-btn ${item.sent ? 'sent' : ''}"
                                                    onclick="sendHaradaToTasks('${goal.id}', ${sIndex}, ${iIndex})"
                                                    title="${item.sent ? 'Already sent' : 'Send to tasks'}">
                                                    <i class="fas fa-${item.sent ? 'check' : 'arrow-right'}"></i>
                                                </button>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div id="haradaGrid_${goal.id}" class="harada-grid-container" style="display: none;">
                        ${renderHaradaGridView(goal)}
                    </div>
                </div>
            `;
        }
        
        // Show Harada list view
        function showHaradaList(goalId) {
            document.getElementById('haradaList_' + goalId).style.display = 'block';
            document.getElementById('haradaGrid_' + goalId).style.display = 'none';
        }
        
        // Show Harada grid view
        function showHaradaGrid(goalId) {
            document.getElementById('haradaList_' + goalId).style.display = 'none';
            document.getElementById('haradaGrid_' + goalId).style.display = 'block';
        }
        
        // Render Harada grid view
        function renderHaradaGridView(goal) {
            const grid = [];
            const subgoals = goal.haradaData.subgoals;
            
            // Map grid positions to subgoals
            const layout = [
                [0,0,0, 1,1,1, 2,2,2],
                [0,0,0, 1,1,1, 2,2,2],
                [0,0,0, 1,1,1, 2,2,2],
                [7,7,7, -1,-1,-1, 3,3,3],
                [7,7,7, -1,-1,-1, 3,3,3],
                [7,7,7, -1,-1,-1, 3,3,3],
                [6,6,6, 5,5,5, 4,4,4],
                [6,6,6, 5,5,5, 4,4,4],
                [6,6,6, 5,5,5, 4,4,4]
            ];
            
            for (let row = 0; row < 9; row++) {
                for (let col = 0; col < 9; col++) {
                    const subgoalIndex = layout[row][col];
                    const localRow = row % 3;
                    const localCol = col % 3;
                    
                    let cellContent = '';
                    let cellClass = 'harada-cell';
                    
                    // Center goal
                    if (row >= 3 && row <= 5 && col >= 3 && col <= 5) {
                        if (row === 4 && col === 4) {
                            cellClass += ' center';
                            cellContent = goal.haradaData.centerGoal;
                        } else {
                            continue; // Skip other center cells
                        }
                    }
                    // Subgoal cells
                    else if (subgoalIndex >= 0) {
                        const subgoal = subgoals[subgoalIndex];
                        
                        // Header row (subgoal name)
                        if (localRow === 0 && localCol === 1) {
                            cellClass += ' subgoal-header';
                            cellContent = `<input type="text" class="harada-cell-input" value="${subgoal.name}" 
                                onchange="updateHaradaGrid('${goal.id}', ${row}, ${col}, this.value)">`;
                        }
                        // Item cells
                        else if (localRow > 0) {
                            const itemIndex = (localRow - 1) * 3 + localCol;
                            if (itemIndex < 8) {
                                const item = subgoal.items[itemIndex];
                                cellContent = `<input type="text" class="harada-cell-input" value="${item.text}"
                                    onchange="updateHaradaGrid('${goal.id}', ${row}, ${col}, this.value)"
                                    placeholder="${item.label}">`;
                            }
                        }
                    }
                    
                    grid.push(`<div class="${cellClass}">${cellContent}</div>`);
                }
            }
            
            return `<div class="harada-grid">${grid.join('')}</div>`;
        }
        
        // Toggle task completed
        function toggleTaskCompleted(id) {
            const task = tasks.find(t => t.id === id);
            if (!task) return;
            
            task.completed = !task.completed;
            
            if (task.completed) {
                showToast('Complete!', 'Task marked as completed', 'success');
            }
            
            saveData();
            renderTasks();
            updateStats();
            updateCounts();
        }
        
        // Update task notes
        function updateTaskNotes(id, notes) {
            const task = tasks.find(t => t.id === id);
            if (!task) return;
            
            task.notes = notes;
            saveData();
        }
        
        // Update task area
        function updateTaskArea(id, area) {
            const task = tasks.find(t => t.id === id);
            if (!task) return;
            
            task.area = area;
            saveData();
            renderTasks();
        }
        
        // Delete task
        function deleteTask(id) {
            const index = tasks.findIndex(t => t.id === id);
            if (index > -1) {
                const task = tasks.splice(index, 1)[0];
                graveyard.tasks.push(task);
                
                showToast('Archived', 'Task moved to graveyard', 'info');
                
                saveData();
                renderTasks();
                renderGraveyard();
                updateStats();
                updateCounts();
            }
        }
        
        // Render tasks
        function renderTasks() {
            const container = document.getElementById('tasksList');
            const sortedTasks = sortTasksArray(tasks, taskSortCriteria);
            
            let filteredTasks = sortedTasks;
            if (!showFinishedTasks) {
                filteredTasks = sortedTasks.filter(t => !t.completed);
            }
            
            if (filteredTasks.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 40px;">No tasks yet. Add tasks from goals or use Harada method!</p>';
                return;
            }
            
            container.innerHTML = filteredTasks.map(task => {
                const cardClass = `card ${task.haradaSource ? 'harada-task' : ''}`;
                
                return `
                    <div class="${cardClass}">
                        <div class="card-meta">
                            <select class="meta-tag" onchange="updateTaskArea('${task.id}', this.value)" 
                                style="background: var(--bg-tertiary); border: none; color: var(--text-secondary); cursor: pointer;">
                                <option value="">Select area...</option>
                                ${['Diet', 'Family', 'Fitness', 'Health', 'Home', 'Parenting', 'Personal', 'Relationship', 'Sleep', 'Social Life', 'Study', 'Work'].map(area => 
                                    `<option value="${area}" ${task.area === area ? 'selected' : ''}>${area}</option>`
                                ).join('')}
                            </select>
                            ${task.haradaSource ? `
                                <span class="meta-tag" style="background: var(--harada-highlight);">
                                    <i class="fas fa-th"></i> Harada: ${task.haradaSource.subgoalNumber}.${task.haradaSource.itemLabel}
                                </span>
                            ` : ''}
                            ${task.goalId ? `
                                <span class="meta-tag"><i class="fas fa-bullseye"></i> From Goal</span>
                            ` : ''}
                        </div>
                        
                        <div class="card-description ${task.completed ? 'finished' : ''}">
                            ${task.description}
                        </div>
                        
                        ${task.goalDescription ? `
                            <div style="color: var(--text-secondary); font-size: 0.9em; margin-top: 10px;">
                                <i class="fas fa-link"></i> ${task.goalDescription}
                            </div>
                        ` : ''}
                        
                        <div class="form-group" style="margin-top: 15px;">
                            <label>Notes</label>
                            <textarea placeholder="Add notes about this task..."
                                onchange="updateTaskNotes('${task.id}', this.value)"
                                style="min-height: 80px;">${task.notes || ''}</textarea>
                        </div>
                        
                        <div class="card-actions">
                            <button class="card-btn" onclick="toggleTaskCompleted('${task.id}')">
                                <i class="fas fa-${task.completed ? 'undo' : 'check'}"></i>
                                ${task.completed ? 'Uncomplete' : 'Mark Complete'}
                            </button>
                            ${task.completed ? `
                                <button class="delete-btn" onclick="deleteTask('${task.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Render graveyard
        function renderGraveyard() {
            // Problems
            const problemsContainer = document.getElementById('graveyardProblems');
            if (graveyard.problems.length === 0) {
                problemsContainer.innerHTML = '<p style="color: var(--text-secondary);">No finished problems</p>';
            } else {
                problemsContainer.innerHTML = graveyard.problems.map(problem => `
                    <div class="graveyard-card">
                        <div class="card-meta" style="margin-bottom: 10px;">
                            <span class="meta-tag">${problem.area}</span>
                            <span class="meta-tag">${problem.emotion}</span>
                        </div>
                        <div class="card-description" style="font-size: 0.9em;">
                            ${problem.description}
                        </div>
                        <button class="reactivate-btn" onclick="reactivateProblem('${problem.id}')">
                            <i class="fas fa-redo"></i> Reactivate
                        </button>
                    </div>
                `).join('');
            }
            
            // Goals
            const goalsContainer = document.getElementById('graveyardGoals');
            if (graveyard.goals.length === 0) {
                goalsContainer.innerHTML = '<p style="color: var(--text-secondary);">No finished goals</p>';
            } else {
                goalsContainer.innerHTML = graveyard.goals.map(goal => `
                    <div class="graveyard-card">
                        <div class="card-meta" style="margin-bottom: 10px;">
                            <span class="meta-tag">${goal.area}</span>
                            <span class="meta-tag">${goal.problemIds.length} problems</span>
                        </div>
                        <div class="card-description" style="font-size: 0.9em;">
                            ${goal.description}
                        </div>
                        <button class="reactivate-btn" onclick="reactivateGoal('${goal.id}')">
                            <i class="fas fa-redo"></i> Reactivate
                        </button>
                    </div>
                `).join('');
            }
            
            // Tasks
            const tasksContainer = document.getElementById('graveyardTasks');
            if (graveyard.tasks.length === 0) {
                tasksContainer.innerHTML = '<p style="color: var(--text-secondary);">No completed tasks</p>';
            } else {
                tasksContainer.innerHTML = graveyard.tasks.map(task => `
                    <div class="graveyard-card">
                        <div class="card-meta" style="margin-bottom: 10px;">
                            ${task.area ? `<span class="meta-tag">${task.area}</span>` : ''}
                            ${task.haradaSource ? `<span class="meta-tag">Harada</span>` : ''}
                        </div>
                        <div class="card-description" style="font-size: 0.9em;">
                            ${task.description}
                        </div>
                        <button class="reactivate-btn" onclick="reactivateTask('${task.id}')">
                            <i class="fas fa-redo"></i> Reactivate
                        </button>
                    </div>
                `).join('');
            }
            
            updateCounts();
        }
        
        // Reactivate functions
        function reactivateProblem(id) {
            const index = graveyard.problems.findIndex(p => p.id === id);
            if (index > -1) {
                const problem = graveyard.problems.splice(index, 1)[0];
                problem.finished = false;
                problems.push(problem);
                
                showToast('Reactivated!', 'Problem restored', 'success');
                
                saveData();
                renderProblems();
                renderGraveyard();
                updateStats();
                updateCounts();
            }
        }
        
        function reactivateGoal(id) {
            const index = graveyard.goals.findIndex(g => g.id === id);
            if (index > -1) {
                const goal = graveyard.goals.splice(index, 1)[0];
                goal.finished = false;
                goals.push(goal);
                
                // Reactivate associated problems
                goal.problemIds.forEach(problemId => {
                    const pIndex = graveyard.problems.findIndex(p => p.id === problemId);
                    if (pIndex > -1) {
                        const problem = graveyard.problems.splice(pIndex, 1)[0];
                        problem.finished = false;
                        problems.push(problem);
                    }
                });
                
                showToast('Reactivated!', 'Goal and associated problems restored', 'success');
                
                saveData();
                renderGoals();
                renderProblems();
                renderGraveyard();
                updateStats();
                updateCounts();
            }
        }
        
        function reactivateTask(id) {
            const index = graveyard.tasks.findIndex(t => t.id === id);
            if (index > -1) {
                const task = graveyard.tasks.splice(index, 1)[0];
                task.completed = false;
                tasks.push(task);
                
                showToast('Reactivated!', 'Task restored', 'success');
                
                saveData();
                renderTasks();
                renderGraveyard();
                updateStats();
                updateCounts();
            }
        }
        
        // Sorting functions
        function sortProblems(criteria) {
            problemSortCriteria = criteria;
            renderProblems();
        }
        
        function sortGoals(criteria) {
            goalSortCriteria = criteria;
            renderGoals();
        }
        
        function sortTasks(criteria) {
            taskSortCriteria = criteria;
            renderTasks();
        }
        
        function sortArray(arr, criteria) {
            const sorted = [...arr];
            
            switch(criteria) {
                case 'recent':
                    return sorted.sort((a, b) => b.timestamp - a.timestamp);
                case 'area':
                    return sorted.sort((a, b) => a.area.localeCompare(b.area));
                case 'emotion':
                    return sorted.sort((a, b) => a.emotion.localeCompare(b.emotion));
                case 'difficulty':
                    return sorted.sort((a, b) => b.difficulty - a.difficulty);
                default:
                    return sorted;
            }
        }
        
        function sortTasksArray(arr, criteria) {
            const sorted = [...arr];
            
            switch(criteria) {
                case 'recent':
                    return sorted.sort((a, b) => b.timestamp - a.timestamp);
                case 'goal':
                    return sorted.sort((a, b) => {
                        if (!a.goalId && !b.goalId) return 0;
                        if (!a.goalId) return 1;
                        if (!b.goalId) return -1;
                        return a.goalDescription.localeCompare(b.goalDescription);
                    });
                case 'area':
                    return sorted.sort((a, b) => {
                        if (!a.area && !b.area) return 0;
                        if (!a.area) return 1;
                        if (!b.area) return -1;
                        return a.area.localeCompare(b.area);
                    });
                default:
                    return sorted;
            }
        }
        
        // Toggle finished
        function toggleFinishedProblems() {
            showFinishedProblems = !showFinishedProblems;
            document.getElementById('showHideProblems').textContent = showFinishedProblems ? 'Hide' : 'Show';
            renderProblems();
        }
        
        function toggleFinishedGoals() {
            showFinishedGoals = !showFinishedGoals;
            document.getElementById('showHideGoals').textContent = showFinishedGoals ? 'Hide' : 'Show';
            renderGoals();
        }
        
        function toggleFinishedTasks() {
            showFinishedTasks = !showFinishedTasks;
            document.getElementById('showHideTasks').textContent = showFinishedTasks ? 'Hide' : 'Show';
            renderTasks();
        }
        
        // Update counts
        function updateCounts() {
            document.getElementById('problemsCount').textContent = problems.filter(p => !p.finished).length;
            document.getElementById('goalsCount').textContent = goals.filter(g => !g.finished).length;
            document.getElementById('tasksCount').textContent = tasks.filter(t => !t.completed).length;
            
            const graveyardTotal = graveyard.problems.length + graveyard.goals.length + graveyard.tasks.length;
            document.getElementById('graveyardCount').textContent = graveyardTotal;
        }
        
        // Star ratings
        function initStarRatings() {
            // Problem rating
            const problemStars = document.querySelectorAll('#problemRating .star');
            problemStars.forEach(star => {
                star.addEventListener('click', function() {
                    currentProblemRating = parseInt(this.dataset.rating);
                    updateProblemStars();
                });
                
                star.addEventListener('mouseenter', function() {
                    const rating = parseInt(this.dataset.rating);
                    problemStars.forEach((s, i) => {
                        if (i < rating) {
                            s.classList.add('filled');
                        } else {
                            s.classList.remove('filled');
                        }
                    });
                });
            });
            
            document.getElementById('problemRating').addEventListener('mouseleave', updateProblemStars);
            
            // Goal rating
            const goalStars = document.querySelectorAll('#goalRating .star');
            goalStars.forEach(star => {
                star.addEventListener('click', function() {
                    currentGoalRating = parseInt(this.dataset.rating);
                    updateGoalStars();
                });
                
                star.addEventListener('mouseenter', function() {
                    const rating = parseInt(this.dataset.rating);
                    goalStars.forEach((s, i) => {
                        if (i < rating) {
                            s.classList.add('filled');
                        } else {
                            s.classList.remove('filled');
                        }
                    });
                });
            });
            
            document.getElementById('goalRating').addEventListener('mouseleave', updateGoalStars);
        }
        
        function updateProblemStars() {
            const stars = document.querySelectorAll('#problemRating .star');
            stars.forEach((star, i) => {
                if (i < currentProblemRating) {
                    star.classList.add('filled');
                } else {
                    star.classList.remove('filled');
                }
            });
            
            const descriptions = {
                1: 'Fixable now',
                2: 'Fixable soon',
                3: 'Fixable with the right resources',
                4: 'Fixable with the right resources and skills',
                5: 'Fixable with the right resources, skills, and cooperation from other people'
            };
            
            document.getElementById('problemRatingDesc').textContent = currentProblemRating > 0 ? descriptions[currentProblemRating] : '';
        }
        
        function updateGoalStars() {
            const stars = document.querySelectorAll('#goalRating .star');
            stars.forEach((star, i) => {
                if (i < currentGoalRating) {
                    star.classList.add('filled');
                } else {
                    star.classList.remove('filled');
                }
            });
            
            const descriptions = {
                1: 'Achievable now',
                2: 'Achievable soon',
                3: 'Achievable with the right resources',
                4: 'Achievable with the right resources and skills',
                5: 'Achievable with the right resources, skills, and cooperation from other people'
            };
            
            document.getElementById('goalRatingDesc').textContent = currentGoalRating > 0 ? descriptions[currentGoalRating] : '';
        }
        
        // Goal emotion listener
        function initGoalEmotionListener() {
            document.getElementById('goalEmotion').addEventListener('change', function() {
                const warning = document.getElementById('difficultWarning');
                if (this.value === 'Difficult') {
                    warning.style.display = 'block';
                } else {
                    warning.style.display = 'none';
                }
            });
        }
        
        // Update stats and charts
        function updateStats() {
            updateProgressBar();
            updateCharts();
        }
        
        function updateProgressBar() {
            const totalTasks = tasks.length;
            const completedTasks = tasks.filter(t => t.completed).length;
            const percentage = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            
            const fill = document.getElementById('progressFill');
            fill.style.width = percentage + '%';
            fill.textContent = percentage + '%';
        }
        
        function updateCharts() {
            // Problems by Area
            updatePieChart('problemsAreaChart', 'Problems by Area', 
                countByField(problems.filter(p => !p.finished), 'area'));
            
            // Problems by Emotion
            updatePieChart('problemsEmotionChart', 'Problems by Emotion',
                countByField(problems.filter(p => !p.finished), 'emotion'));
            
            // Goals by Area
            updatePieChart('goalsAreaChart', 'Goals by Area',
                countByField(goals.filter(g => !g.finished), 'area'));
            
            // Goals by Emotion
            updatePieChart('goalsEmotionChart', 'Goals by Emotion',
                countByField(goals.filter(g => !g.finished), 'emotion'));
        }
        
        function countByField(arr, field) {
            const counts = {};
            arr.forEach(item => {
                const value = item[field] || 'Unspecified';
                counts[value] = (counts[value] || 0) + 1;
            });
            return counts;
        }
        
        function updatePieChart(canvasId, title, data) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            
            // Destroy existing chart
            if (charts[canvasId]) {
                charts[canvasId].destroy();
            }
            
            const labels = Object.keys(data);
            const values = Object.values(data);
            
            if (labels.length === 0) {
                // Show empty state
                charts[canvasId] = new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: ['No data'],
                        datasets: [{
                            data: [1],
                            backgroundColor: ['#333']
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: {
                                display: true,
                                text: title,
                                color: '#eee'
                            },
                            legend: {
                                labels: {
                                    color: '#aaa'
                                }
                            }
                        }
                    }
                });
                return;
            }
            
            const colors = [
                '#e94560', '#533483', '#4ecca3', '#f4a261', '#6a4c93',
                '#2a9d8f', '#e76f51', '#264653', '#e9c46a', '#f77f00'
            ];
            
            charts[canvasId] = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: values,
                        backgroundColor: colors.slice(0, labels.length)
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: title,
                            color: '#eee'
                        },
                        legend: {
                            labels: {
                                color: '#aaa'
                            }
                        }
                    }
                }
            });
        }
        
        // Toast notifications
        function showToast(title, message, type) {
            const bgColors = {
                success: 'linear-gradient(135deg, #4ecca3, #2a9d8f)',
                error: 'linear-gradient(135deg, #e94560, #d63850)',
                info: 'linear-gradient(135deg, #533483, #6a4c93)'
            };
            
            Toastify({
                text: `<strong>${title}</strong><br>${message}`,
                duration: 5000,
                gravity: 'bottom',
                position: 'right',
                backgroundColor: bgColors[type] || bgColors.info,
                stopOnFocus: true,
                escapeMarkup: false
            }).showToast();
        }
        
        // Help modal
        function toggleHelp() {
            document.getElementById('helpModal').classList.toggle('active');
        }
        
        // Render all
        function renderAll() {
            renderProblems();
            renderGoals();
            renderTasks();
            renderGraveyard();
            updateCounts();
        }
    </script>
</body>
</html>
